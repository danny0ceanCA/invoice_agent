{"id": "0001", "question": "Show monthly spend for Addison Johnson.", "text": "Here is the monthly spend for Addison Johnson for July and August.", "sql_used": null, "rows": null, "html": "<p>Here is the monthly spend for Addison Johnson for July and August.</p>"}
{"id": "0002", "question": "Show monthly hours for Addison Johnson.", "text": "These questions are about monthly hours for a specific student, so we focus on the invoices table where student hours are recorded at the invoice level. We filter by district_key to scope to the correct district and match student_name case\u2011insensitively to the requested student. To show hours by month, we group by service_month (lowercased) and sum total_hours within each month. The result is a month\u2011by\u2011month view of total hours delivered to that student.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to understand SCUSD invoice data and produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost or highest-hours students  \n- Ranking vendors by cost or hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.  \n  Often duplicated across line items.\n\n- **clinician** (TEXT)  \n  Role or name of the clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service was delivered.\n\n- **hours** (REAL)  \n  Hours billed for this service entry.\n\n- **cost** (REAL)  \n  Charge for this line item.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day service review  \n- Clinician-level analysis  \n- Clinician-type cost or hours  \n- Vendor line-item analysis  \n- Student service breakdown for specific months  \n- Temporal detail (service_date)  \n- Anything involving individual entries, not aggregates\n\n**Important:**  \nTo get aggregated hours or cost, join to invoices using:\n\ninvoice_line_items.invoice_id = invoices.id\n\n{\"sql\": \"SELECT LOWER(service_month) AS service_month, SUM(total_hours) AS total_hours FROM invoices WHERE district_key = :district_key AND LOWER(student_name) = LOWER(:student_name) GROUP BY LOWER(service_month)\"}", "sql_used": null, "rows": null, "html": "<p>These questions are about monthly hours for a specific student, so we focus on the invoices table where student hours are recorded at the invoice level. We filter by district_key to scope to the correct district and match student_name case\u2011insensitively to the requested student. To show hours by month, we group by service_month (lowercased) and sum total_hours within each month. The result is a month\u2011by\u2011month view of total hours delivered to that student.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to understand SCUSD invoice data and produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost or highest-hours students  \n- Ranking vendors by cost or hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.  \n  Often duplicated across line items.\n\n- **clinician** (TEXT)  \n  Role or name of the clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service was delivered.\n\n- **hours** (REAL)  \n  Hours billed for this service entry.\n\n- **cost** (REAL)  \n  Charge for this line item.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day service review  \n- Clinician-level analysis  \n- Clinician-type cost or hours  \n- Vendor line-item analysis  \n- Student service breakdown for specific months  \n- Temporal detail (service_date)  \n- Anything involving individual entries, not aggregates\n\n**Important:**  \nTo get aggregated hours or cost, join to invoices using:\n\ninvoice_line_items.invoice_id = invoices.id\n\n{&quot;sql&quot;: &quot;SELECT LOWER(service_month) AS service_month, SUM(total_hours) AS total_hours FROM invoices WHERE district_key = :district_key AND LOWER(student_name) = LOWER(:student_name) GROUP BY LOWER(service_month)&quot;}</p>"}
{"id": "0003", "question": "Show year-to-date spend for Addison Perez.", "text": "Fetched 4 invoices for Addison Perez.", "sql_used": "SELECT invoice_number, student_name, total_cost, service_month, status FROM invoices WHERE invoices.district_key = :district_key AND LOWER(invoices.student_name) LIKE LOWER('%Addison Perez%') ORDER BY invoice_date DESC, total_cost DESC", "rows": [{"invoice_number": "Perez-OCT2025", "student_name": "Addison Perez", "total_cost": 5838.849999999999, "service_month": "october", "status": "generated"}, {"invoice_number": "Perez-SEP2025", "student_name": "Addison Perez", "total_cost": 5698.45, "service_month": "september", "status": "generated"}, {"invoice_number": "Perez-AUG2025", "student_name": "Addison Perez", "total_cost": 5177.25, "service_month": "august", "status": "generated"}, {"invoice_number": "Perez-JUL2025", "student_name": "Addison Perez", "total_cost": 4907.95, "service_month": "july", "status": "generated"}], "html": "<div class=\"table-wrapper\"><table class=\"analytics-table\"><thead><tr><th>invoice_number</th><th>student_name</th><th>total_cost</th><th>service_month</th><th>status</th></tr></thead><tbody><tr><td>Perez-OCT2025</td><td>Addison Perez</td><td class=\"amount-col\">$5,838.85</td><td>october</td><td>generated</td></tr><tr><td>Perez-SEP2025</td><td>Addison Perez</td><td class=\"amount-col\">$5,698.45</td><td>september</td><td>generated</td></tr><tr><td>Perez-AUG2025</td><td>Addison Perez</td><td class=\"amount-col\">$5,177.25</td><td>august</td><td>generated</td></tr><tr><td>Perez-JUL2025</td><td>Addison Perez</td><td class=\"amount-col\">$4,907.95</td><td>july</td><td>generated</td></tr></tbody></table></div>"}
{"id": "0004", "question": "Show year-to-date hours for Addison Perez.", "text": "Fetched 4 invoices for Addison Perez.", "sql_used": "SELECT invoice_number, student_name, total_cost, service_month, status FROM invoices WHERE invoices.district_key = :district_key AND LOWER(invoices.student_name) LIKE LOWER('%Addison Perez%') ORDER BY invoice_date DESC, total_cost DESC", "rows": [{"invoice_number": "Perez-OCT2025", "student_name": "Addison Perez", "total_cost": 5838.849999999999, "service_month": "october", "status": "generated"}, {"invoice_number": "Perez-SEP2025", "student_name": "Addison Perez", "total_cost": 5698.45, "service_month": "september", "status": "generated"}, {"invoice_number": "Perez-AUG2025", "student_name": "Addison Perez", "total_cost": 5177.25, "service_month": "august", "status": "generated"}, {"invoice_number": "Perez-JUL2025", "student_name": "Addison Perez", "total_cost": 4907.95, "service_month": "july", "status": "generated"}], "html": "<div class=\"table-wrapper\"><table class=\"analytics-table\"><thead><tr><th>invoice_number</th><th>student_name</th><th>total_cost</th><th>service_month</th><th>status</th></tr></thead><tbody><tr><td>Perez-OCT2025</td><td>Addison Perez</td><td class=\"amount-col\">$5,838.85</td><td>october</td><td>generated</td></tr><tr><td>Perez-SEP2025</td><td>Addison Perez</td><td class=\"amount-col\">$5,698.45</td><td>september</td><td>generated</td></tr><tr><td>Perez-AUG2025</td><td>Addison Perez</td><td class=\"amount-col\">$5,177.25</td><td>august</td><td>generated</td></tr><tr><td>Perez-JUL2025</td><td>Addison Perez</td><td class=\"amount-col\">$4,907.95</td><td>july</td><td>generated</td></tr></tbody></table></div>"}
{"id": "0005", "question": "Which students have the highest total spend this school year?", "text": "These questions are about the highest-spend students in a district over the current school year. We use the invoices table where total cost per student per month is readily available. A school\u2011year CTE defines sy.start and sy.end as July 1 through June 30 of the following year, and we filter invoice_date into this window. We scope by district_key to ensure the ranking is district\u2011specific. We group by student_name (normalized to lower case) and calculate SUM(total_cost) as each student\u2019s total spend for the school year. The result set is ordered by total_spend descending and limited to the top few students, revealing which students drive the highest costs.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to understand SCUSD invoice data and produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost or highest-hours students  \n- Ranking vendors by cost or hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.  \n  Often duplicated across line items.\n\n- **clinician** (TEXT)  \n  Role or name of the clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service was delivered.\n\n- **hours** (REAL)  \n  Hours billed for this service entry.\n\n- **cost** (REAL)  \n  Charge for this line item.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day service review  \n- Clinician-level analysis  \n- Clinician-type cost or hours  \n- Vendor line-item analysis  \n- Student service breakdown for specific months  \n- Temporal detail (service_date)  \n- Anything involving individual entries, not aggregates\n\n**Important:**  \nTo get aggregated hours or cost, join to invoices using:\n\ninvoice_line_items.invoice_id = invoices.id\n---\n  \n# ============================\n# SQL TEMPLATE: Top Students by Spend\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime('%Y','now')||'-07-01') AS start,\n         date(strftime('%Y','now')||'-06-30','+1 year') AS end\n)\nSELECT LOWER(i.student_name) AS student_name,\n       SUM(i.total_cost) AS total_spend\nFROM invoices i, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end\nGROUP BY LOWER(i.student_name)\nORDER BY total_spend DESC\nLIMIT 5;", "sql_used": null, "rows": null, "html": "<p>These questions are about the highest-spend students in a district over the current school year. We use the invoices table where total cost per student per month is readily available. A school\u2011year CTE defines sy.start and sy.end as July 1 through June 30 of the following year, and we filter invoice_date into this window. We scope by district_key to ensure the ranking is district\u2011specific. We group by student_name (normalized to lower case) and calculate SUM(total_cost) as each student\u2019s total spend for the school year. The result set is ordered by total_spend descending and limited to the top few students, revealing which students drive the highest costs.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to understand SCUSD invoice data and produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost or highest-hours students  \n- Ranking vendors by cost or hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.  \n  Often duplicated across line items.\n\n- **clinician** (TEXT)  \n  Role or name of the clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service was delivered.\n\n- **hours** (REAL)  \n  Hours billed for this service entry.\n\n- **cost** (REAL)  \n  Charge for this line item.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day service review  \n- Clinician-level analysis  \n- Clinician-type cost or hours  \n- Vendor line-item analysis  \n- Student service breakdown for specific months  \n- Temporal detail (service_date)  \n- Anything involving individual entries, not aggregates\n\n**Important:**  \nTo get aggregated hours or cost, join to invoices using:\n\ninvoice_line_items.invoice_id = invoices.id\n---\n  \n# ============================\n# SQL TEMPLATE: Top Students by Spend\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start,\n         date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end\n)\nSELECT LOWER(i.student_name) AS student_name,\n       SUM(i.total_cost) AS total_spend\nFROM invoices i, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end\nGROUP BY LOWER(i.student_name)\nORDER BY total_spend DESC\nLIMIT 5;</p>"}
{"id": "0006", "question": "Which students have the highest total hours this school year?", "text": "Here are the students with the highest total hours this school year.", "sql_used": null, "rows": null, "html": "<p>Here are the students with the highest total hours this school year.</p>"}
{"id": "0007", "question": "Show students with increased hours compared to last month.", "text": "These questions ask for students whose service hours have increased compared to the previous month. To determine this, we first compute monthly total hours per student using the invoices table, scoped by district_key and grouped by student_name and service_month. A CTE (monthly_hours) captures this month\u2011by\u2011month view. Next, we use window functions (such as LAG) to look back at the previous month\u2019s hours for each student. In the final query, we compare the current month\u2019s hours to the previous month and filter for cases where the current hours are greater. This reveals students whose billed hours are trending up, along with the magnitude of the increase.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to understand SCUSD invoice data and produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost or highest-hours students  \n- Ranking vendors by cost or hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.  \n  Often duplicated across line items.\n\n- **clinician** (TEXT)  \n  Role or name of the clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service was delivered.\n\n- **hours** (REAL)  \n  Hours billed for this service entry.\n\n- **cost** (REAL)  \n  Charge for this line item.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day service review  \n- Clinician-level analysis  \n- Clinician-type cost or hours  \n- Vendor line-item analysis  \n- Student service breakdown for specific months  \n- Temporal detail (service_date)  \n- Anything involving individual entries, not aggregates\n\n**Important:**  \nTo get aggregated hours or cost, join to invoices using:\n\ninvoice_line_items.invoice_id = invoices.id\n---\n  \n# ============================\n# SQL TEMPLATE: Students with Increasing Hours\n# ============================\n\nWITH monthly_hours AS (\n  SELECT LOWER(i.student_name) AS student_name,\n         LOWER(i.service_month) AS service_month,\n         SUM(i.total_hours) AS total_hours\n  FROM invoices i\n  WHERE i.district_key = :district_key\n  GROUP BY LOWER(i.student_name), LOWER(i.service_month)\n),\nranked AS (\n  SELECT student_name,\n         service_month,\n         total_hours,\n         LAG(total_hours) OVER (PARTITION BY student_name ORDER BY service_month) AS prev_month_hours\n  FROM monthly_hours\n)\nSELECT student_name, service_month, total_hours, prev_month_hours\nFROM ranked\nWHERE prev_month_hours IS NOT NULL\n  AND total_hours > prev_month_hours\nORDER BY student_name, service_month;", "sql_used": null, "rows": null, "html": "<p>These questions ask for students whose service hours have increased compared to the previous month. To determine this, we first compute monthly total hours per student using the invoices table, scoped by district_key and grouped by student_name and service_month. A CTE (monthly_hours) captures this month\u2011by\u2011month view. Next, we use window functions (such as LAG) to look back at the previous month\u2019s hours for each student. In the final query, we compare the current month\u2019s hours to the previous month and filter for cases where the current hours are greater. This reveals students whose billed hours are trending up, along with the magnitude of the increase.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to understand SCUSD invoice data and produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost or highest-hours students  \n- Ranking vendors by cost or hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.  \n  Often duplicated across line items.\n\n- **clinician** (TEXT)  \n  Role or name of the clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service was delivered.\n\n- **hours** (REAL)  \n  Hours billed for this service entry.\n\n- **cost** (REAL)  \n  Charge for this line item.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day service review  \n- Clinician-level analysis  \n- Clinician-type cost or hours  \n- Vendor line-item analysis  \n- Student service breakdown for specific months  \n- Temporal detail (service_date)  \n- Anything involving individual entries, not aggregates\n\n**Important:**  \nTo get aggregated hours or cost, join to invoices using:\n\ninvoice_line_items.invoice_id = invoices.id\n---\n  \n# ============================\n# SQL TEMPLATE: Students with Increasing Hours\n# ============================\n\nWITH monthly_hours AS (\n  SELECT LOWER(i.student_name) AS student_name,\n         LOWER(i.service_month) AS service_month,\n         SUM(i.total_hours) AS total_hours\n  FROM invoices i\n  WHERE i.district_key = :district_key\n  GROUP BY LOWER(i.student_name), LOWER(i.service_month)\n),\nranked AS (\n  SELECT student_name,\n         service_month,\n         total_hours,\n         LAG(total_hours) OVER (PARTITION BY student_name ORDER BY service_month) AS prev_month_hours\n  FROM monthly_hours\n)\nSELECT student_name, service_month, total_hours, prev_month_hours\nFROM ranked\nWHERE prev_month_hours IS NOT NULL\n  AND total_hours &gt; prev_month_hours\nORDER BY student_name, service_month;</p>"}
{"id": "0008", "question": "Show students with decreased hours compared to last month.", "text": "These questions ask for students whose service hours have decreased compared to the previous month. We use a similar approach to the increasing hours query: a CTE (monthly_hours) computes total hours per student per month from the invoices table, scoped by district_key. A window function (LAG) retrieves the previous month\u2019s hours for each student. In the final query, we filter for cases where the current month\u2019s hours are less than the previous month and both values are present. This highlights students whose billed hours are trending down, along with the magnitude of the decrease.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to understand SCUSD invoice data and produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost or highest-hours students  \n- Ranking vendors by cost or hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.  \n  Often duplicated across line items.\n\n- **clinician** (TEXT)  \n  Role or name of the clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service was delivered.\n\n- **hours** (REAL)  \n  Hours billed for this service entry.\n\n- **cost** (REAL)  \n  Charge for this line item.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day service review  \n- Clinician-level analysis  \n- Clinician-type cost or hours  \n- Vendor line-item analysis  \n- Student service breakdown for specific months  \n- Temporal detail (service_date)  \n- Anything involving individual entries, not aggregates\n\n**Important:**  \nTo get aggregated hours or cost, join to invoices using:\n\ninvoice_line_items.invoice_id = invoices.id\n---\n  \n# ============================\n# SQL TEMPLATE: Students with Decreasing Hours\n# ============================\n\nWITH monthly_hours AS (\n  SELECT LOWER(i.student_name) AS student_name,\n         LOWER(i.service_month) AS service_month,\n         SUM(i.total_hours) AS total_hours\n  FROM invoices i\n  WHERE i.district_key = :district_key\n  GROUP BY LOWER(i.student_name), LOWER(i.service_month)\n),\nranked AS (\n  SELECT student_name,\n         service_month,\n         total_hours,\n         LAG(total_hours) OVER (PARTITION BY student_name ORDER BY service_month) AS prev_month_hours\n  FROM monthly_hours\n)\nSELECT student_name, service_month, total_hours, prev_month_hours\nFROM ranked\nWHERE prev_month_hours IS NOT NULL\n  AND total_hours < prev_month_hours\nORDER BY student_name, service_month;", "sql_used": null, "rows": null, "html": "<p>These questions ask for students whose service hours have decreased compared to the previous month. We use a similar approach to the increasing hours query: a CTE (monthly_hours) computes total hours per student per month from the invoices table, scoped by district_key. A window function (LAG) retrieves the previous month\u2019s hours for each student. In the final query, we filter for cases where the current month\u2019s hours are less than the previous month and both values are present. This highlights students whose billed hours are trending down, along with the magnitude of the decrease.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to understand SCUSD invoice data and produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost or highest-hours students  \n- Ranking vendors by cost or hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.  \n  Often duplicated across line items.\n\n- **clinician** (TEXT)  \n  Role or name of the clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service was delivered.\n\n- **hours** (REAL)  \n  Hours billed for this service entry.\n\n- **cost** (REAL)  \n  Charge for this line item.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day service review  \n- Clinician-level analysis  \n- Clinician-type cost or hours  \n- Vendor line-item analysis  \n- Student service breakdown for specific months  \n- Temporal detail (service_date)  \n- Anything involving individual entries, not aggregates\n\n**Important:**  \nTo get aggregated hours or cost, join to invoices using:\n\ninvoice_line_items.invoice_id = invoices.id\n---\n  \n# ============================\n# SQL TEMPLATE: Students with Decreasing Hours\n# ============================\n\nWITH monthly_hours AS (\n  SELECT LOWER(i.student_name) AS student_name,\n         LOWER(i.service_month) AS service_month,\n         SUM(i.total_hours) AS total_hours\n  FROM invoices i\n  WHERE i.district_key = :district_key\n  GROUP BY LOWER(i.student_name), LOWER(i.service_month)\n),\nranked AS (\n  SELECT student_name,\n         service_month,\n         total_hours,\n         LAG(total_hours) OVER (PARTITION BY student_name ORDER BY service_month) AS prev_month_hours\n  FROM monthly_hours\n)\nSELECT student_name, service_month, total_hours, prev_month_hours\nFROM ranked\nWHERE prev_month_hours IS NOT NULL\n  AND total_hours &lt; prev_month_hours\nORDER BY student_name, service_month;</p>"}
{"id": "0009", "question": "Which students started receiving services this school year?", "text": "These questions ask for students whose services began in the current school year, meaning their first invoice appears within the school\u2011year window. We use the invoices table where each invoice is student\u2011vendor\u2011month aggregated. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter invoice_date into this range. We compute, per student, the minimum invoice_date within the school year to find when their billing began. Students are then ranked or filtered based on this first_invoice_date, revealing which students are new or whose services started most recently.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to understand SCUSD invoice data and produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost or highest-hours students  \n- Ranking vendors by cost or hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.  \n  Often duplicated across line items.\n\n- **clinician** (TEXT)  \n  Role or name of the clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service was delivered.\n\n- **hours** (REAL)  \n  Hours billed for this service entry.\n\n- **cost** (REAL)  \n  Charge for this line item.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day service review  \n- Clinician-level analysis  \n- Clinician-type cost or hours  \n- Vendor line-item analysis  \n- Student service breakdown for specific months  \n- Temporal detail (service_date)  \n- Anything involving individual entries, not aggregates\n\n**Important:**  \nTo get aggregated hours or cost, join to invoices using:\n\ninvoice_line_items.invoice_id = invoices.id\n---\n  \n# ============================\n# SQL TEMPLATE: Students by First Invoice Date\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime('%Y','now')||'-07-01') AS start,\n         date(strftime('%Y','now')||'-06-30','+1 year') AS end\n),\nfirst_invoices AS (\n  SELECT LOWER(i.student_name) AS student_name,\n         MIN(date(i.invoice_date)) AS first_invoice_date\n  FROM invoices i, sy\n  WHERE i.district_key = :district_key\n    AND date(i.invoice_date) BETWEEN sy.start AND sy.end\n  GROUP BY LOWER(i.student_name)\n)\nSELECT student_name, first_invoice_date\nFROM first_invoices\nORDER BY first_invoice_date DESC\nLIMIT 10;", "sql_used": null, "rows": null, "html": "<p>These questions ask for students whose services began in the current school year, meaning their first invoice appears within the school\u2011year window. We use the invoices table where each invoice is student\u2011vendor\u2011month aggregated. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter invoice_date into this range. We compute, per student, the minimum invoice_date within the school year to find when their billing began. Students are then ranked or filtered based on this first_invoice_date, revealing which students are new or whose services started most recently.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to understand SCUSD invoice data and produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost or highest-hours students  \n- Ranking vendors by cost or hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.  \n  Often duplicated across line items.\n\n- **clinician** (TEXT)  \n  Role or name of the clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service was delivered.\n\n- **hours** (REAL)  \n  Hours billed for this service entry.\n\n- **cost** (REAL)  \n  Charge for this line item.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day service review  \n- Clinician-level analysis  \n- Clinician-type cost or hours  \n- Vendor line-item analysis  \n- Student service breakdown for specific months  \n- Temporal detail (service_date)  \n- Anything involving individual entries, not aggregates\n\n**Important:**  \nTo get aggregated hours or cost, join to invoices using:\n\ninvoice_line_items.invoice_id = invoices.id\n---\n  \n# ============================\n# SQL TEMPLATE: Students by First Invoice Date\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start,\n         date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end\n),\nfirst_invoices AS (\n  SELECT LOWER(i.student_name) AS student_name,\n         MIN(date(i.invoice_date)) AS first_invoice_date\n  FROM invoices i, sy\n  WHERE i.district_key = :district_key\n    AND date(i.invoice_date) BETWEEN sy.start AND sy.end\n  GROUP BY LOWER(i.student_name)\n)\nSELECT student_name, first_invoice_date\nFROM first_invoices\nORDER BY first_invoice_date DESC\nLIMIT 10;</p>"}
{"id": "0010", "question": "Which students stopped receiving services this school year?", "text": "These questions ask for students whose services have ended or been discontinued within the current school year. We use the invoices table to determine when students last received billed services. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter invoice_date into this window. For each student, we compute the maximum invoice_date within the school year to find their most recent service date. Students are then ranked or filtered based on this last_invoice_date, which can highlight those whose services ended earlier in the school year.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to understand SCUSD invoice data and produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost or highest-hours students  \n- Ranking vendors by cost or hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.  \n  Often duplicated across line items.\n\n- **clinician** (TEXT)  \n  Role or name of the clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this service entry.\n\n- **cost** (REAL)  \n  Charge for this line item.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day service review  \n- Clinician-level analysis  \n- Clinician-type cost or hours  \n- Vendor line-item analysis  \n- Student service breakdown for specific months  \n- Temporal detail (service_date)  \n- Anything involving individual entries, not aggregates\n\n**Important:**  \nTo get aggregated hours or cost, join to invoices using:\n\ninvoice_line_items.invoice_id = invoices.id\n---\n  \n# ============================\n# SQL TEMPLATE: Students by Last Invoice Date\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime('%Y','now')||'-07-01') AS start,\n         date(strftime('%Y','now')||'-06-30','+1 year') AS end\n),\nlast_invoices AS (\n  SELECT LOWER(i.student_name) AS student_name,\n         MAX(date(i.invoice_date)) AS last_invoice_date\n  FROM invoices i, sy\n  WHERE i.district_key = :district_key\n    AND date(i.invoice_date) BETWEEN sy.start AND sy.end\n  GROUP BY LOWER(i.student_name)\n)\nSELECT student_name, last_invoice_date\nFROM last_invoices\nORDER BY last_invoice_date ASC\nLIMIT 10;", "sql_used": null, "rows": null, "html": "<p>These questions ask for students whose services have ended or been discontinued within the current school year. We use the invoices table to determine when students last received billed services. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter invoice_date into this window. For each student, we compute the maximum invoice_date within the school year to find their most recent service date. Students are then ranked or filtered based on this last_invoice_date, which can highlight those whose services ended earlier in the school year.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to understand SCUSD invoice data and produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost or highest-hours students  \n- Ranking vendors by cost or hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.  \n  Often duplicated across line items.\n\n- **clinician** (TEXT)  \n  Role or name of the clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this service entry.\n\n- **cost** (REAL)  \n  Charge for this line item.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day service review  \n- Clinician-level analysis  \n- Clinician-type cost or hours  \n- Vendor line-item analysis  \n- Student service breakdown for specific months  \n- Temporal detail (service_date)  \n- Anything involving individual entries, not aggregates\n\n**Important:**  \nTo get aggregated hours or cost, join to invoices using:\n\ninvoice_line_items.invoice_id = invoices.id\n---\n  \n# ============================\n# SQL TEMPLATE: Students by Last Invoice Date\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start,\n         date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end\n),\nlast_invoices AS (\n  SELECT LOWER(i.student_name) AS student_name,\n         MAX(date(i.invoice_date)) AS last_invoice_date\n  FROM invoices i, sy\n  WHERE i.district_key = :district_key\n    AND date(i.invoice_date) BETWEEN sy.start AND sy.end\n  GROUP BY LOWER(i.student_name)\n)\nSELECT student_name, last_invoice_date\nFROM last_invoices\nORDER BY last_invoice_date ASC\nLIMIT 10;</p>"}
{"id": "0011", "question": "Show total spend for all students by month.", "text": "Found 25 students", "sql_used": "SELECT DISTINCT student_name\n                FROM invoices\n                WHERE district_key = :district_key\n                ORDER BY student_name", "rows": [{"student_name": "Addison Johnson"}, {"student_name": "Addison Perez"}, {"student_name": "Alexander Brown"}, {"student_name": "Alexander Jones"}, {"student_name": "Alexander Thomas"}, {"student_name": "Amelia Gonzalez"}, {"student_name": "Avery Smith"}, {"student_name": "Carter Sanchez"}, {"student_name": "Carter Williams"}, {"student_name": "Chloe Taylor"}, {"student_name": "Elijah Lee"}, {"student_name": "Elijah Lopez"}, {"student_name": "Emma Coleman"}, {"student_name": "Evelyn Ramirez"}, {"student_name": "Hannah Wood"}, {"student_name": "Jack Garcia"}, {"student_name": "Jack Wilson"}, {"student_name": "James Jackson"}, {"student_name": "Jayden Ramsey"}, {"student_name": "Luke Barnes"}, {"student_name": "Matthew Martin"}, {"student_name": "Matthew Rodriguez"}, {"student_name": "Owen Hernandez"}, {"student_name": "Sebastian Jenkins"}, {"student_name": "Wyatt Anderson"}], "html": "<div class=\"table-wrapper\"><table class=\"analytics-table\"><thead><tr><th>student_name</th></tr></thead><tbody><tr><td>Addison Johnson</td></tr><tr><td>Addison Perez</td></tr><tr><td>Alexander Brown</td></tr><tr><td>Alexander Jones</td></tr><tr><td>Alexander Thomas</td></tr><tr><td>Amelia Gonzalez</td></tr><tr><td>Avery Smith</td></tr><tr><td>Carter Sanchez</td></tr><tr><td>Carter Williams</td></tr><tr><td>Chloe Taylor</td></tr><tr><td>Elijah Lee</td></tr><tr><td>Elijah Lopez</td></tr><tr><td>Emma Coleman</td></tr><tr><td>Evelyn Ramirez</td></tr><tr><td>Hannah Wood</td></tr><tr><td>Jack Garcia</td></tr><tr><td>Jack Wilson</td></tr><tr><td>James Jackson</td></tr><tr><td>Jayden Ramsey</td></tr><tr><td>Luke Barnes</td></tr><tr><td>Matthew Martin</td></tr><tr><td>Matthew Rodriguez</td></tr><tr><td>Owen Hernandez</td></tr><tr><td>Sebastian Jenkins</td></tr><tr><td>Wyatt Anderson</td></tr></tbody></table></div>"}
{"id": "0012", "question": "Show total hours for all students by month.", "text": "Found 25 students", "sql_used": "SELECT DISTINCT student_name\n                FROM invoices\n                WHERE district_key = :district_key\n                ORDER BY student_name", "rows": [{"student_name": "Addison Johnson"}, {"student_name": "Addison Perez"}, {"student_name": "Alexander Brown"}, {"student_name": "Alexander Jones"}, {"student_name": "Alexander Thomas"}, {"student_name": "Amelia Gonzalez"}, {"student_name": "Avery Smith"}, {"student_name": "Carter Sanchez"}, {"student_name": "Carter Williams"}, {"student_name": "Chloe Taylor"}, {"student_name": "Elijah Lee"}, {"student_name": "Elijah Lopez"}, {"student_name": "Emma Coleman"}, {"student_name": "Evelyn Ramirez"}, {"student_name": "Hannah Wood"}, {"student_name": "Jack Garcia"}, {"student_name": "Jack Wilson"}, {"student_name": "James Jackson"}, {"student_name": "Jayden Ramsey"}, {"student_name": "Luke Barnes"}, {"student_name": "Matthew Martin"}, {"student_name": "Matthew Rodriguez"}, {"student_name": "Owen Hernandez"}, {"student_name": "Sebastian Jenkins"}, {"student_name": "Wyatt Anderson"}], "html": "<div class=\"table-wrapper\"><table class=\"analytics-table\"><thead><tr><th>student_name</th></tr></thead><tbody><tr><td>Addison Johnson</td></tr><tr><td>Addison Perez</td></tr><tr><td>Alexander Brown</td></tr><tr><td>Alexander Jones</td></tr><tr><td>Alexander Thomas</td></tr><tr><td>Amelia Gonzalez</td></tr><tr><td>Avery Smith</td></tr><tr><td>Carter Sanchez</td></tr><tr><td>Carter Williams</td></tr><tr><td>Chloe Taylor</td></tr><tr><td>Elijah Lee</td></tr><tr><td>Elijah Lopez</td></tr><tr><td>Emma Coleman</td></tr><tr><td>Evelyn Ramirez</td></tr><tr><td>Hannah Wood</td></tr><tr><td>Jack Garcia</td></tr><tr><td>Jack Wilson</td></tr><tr><td>James Jackson</td></tr><tr><td>Jayden Ramsey</td></tr><tr><td>Luke Barnes</td></tr><tr><td>Matthew Martin</td></tr><tr><td>Matthew Rodriguez</td></tr><tr><td>Owen Hernandez</td></tr><tr><td>Sebastian Jenkins</td></tr><tr><td>Wyatt Anderson</td></tr></tbody></table></div>"}
{"id": "0013", "question": "Compare Addison Johnson and Alexander Brown by monthly spend.", "text": "Found 25 students", "sql_used": "SELECT DISTINCT student_name\n                FROM invoices\n                WHERE district_key = :district_key\n                ORDER BY student_name", "rows": [{"student_name": "Addison Johnson"}, {"student_name": "Addison Perez"}, {"student_name": "Alexander Brown"}, {"student_name": "Alexander Jones"}, {"student_name": "Alexander Thomas"}, {"student_name": "Amelia Gonzalez"}, {"student_name": "Avery Smith"}, {"student_name": "Carter Sanchez"}, {"student_name": "Carter Williams"}, {"student_name": "Chloe Taylor"}, {"student_name": "Elijah Lee"}, {"student_name": "Elijah Lopez"}, {"student_name": "Emma Coleman"}, {"student_name": "Evelyn Ramirez"}, {"student_name": "Hannah Wood"}, {"student_name": "Jack Garcia"}, {"student_name": "Jack Wilson"}, {"student_name": "James Jackson"}, {"student_name": "Jayden Ramsey"}, {"student_name": "Luke Barnes"}, {"student_name": "Matthew Martin"}, {"student_name": "Matthew Rodriguez"}, {"student_name": "Owen Hernandez"}, {"student_name": "Sebastian Jenkins"}, {"student_name": "Wyatt Anderson"}], "html": "<div class=\"table-wrapper\"><table class=\"analytics-table\"><thead><tr><th>student_name</th></tr></thead><tbody><tr><td>Addison Johnson</td></tr><tr><td>Addison Perez</td></tr><tr><td>Alexander Brown</td></tr><tr><td>Alexander Jones</td></tr><tr><td>Alexander Thomas</td></tr><tr><td>Amelia Gonzalez</td></tr><tr><td>Avery Smith</td></tr><tr><td>Carter Sanchez</td></tr><tr><td>Carter Williams</td></tr><tr><td>Chloe Taylor</td></tr><tr><td>Elijah Lee</td></tr><tr><td>Elijah Lopez</td></tr><tr><td>Emma Coleman</td></tr><tr><td>Evelyn Ramirez</td></tr><tr><td>Hannah Wood</td></tr><tr><td>Jack Garcia</td></tr><tr><td>Jack Wilson</td></tr><tr><td>James Jackson</td></tr><tr><td>Jayden Ramsey</td></tr><tr><td>Luke Barnes</td></tr><tr><td>Matthew Martin</td></tr><tr><td>Matthew Rodriguez</td></tr><tr><td>Owen Hernandez</td></tr><tr><td>Sebastian Jenkins</td></tr><tr><td>Wyatt Anderson</td></tr></tbody></table></div>"}
{"id": "0014", "question": "Compare Addison Johnson and Alexander Brown by monthly hours.", "text": "Here is the monthly hours comparison for Addison Johnson and Alexander Brown.", "sql_used": null, "rows": null, "html": "<p>Here is the monthly hours comparison for Addison Johnson and Alexander Brown.</p>"}
{"id": "0015", "question": "Show all invoices for Alexander Jones.", "text": "Fetched 4 invoices for Alexander Jones.", "sql_used": "SELECT invoice_number, student_name, total_cost, service_month, status FROM invoices WHERE invoices.district_key = :district_key AND LOWER(invoices.student_name) LIKE LOWER('%Alexander Jones%') ORDER BY invoice_date DESC, total_cost DESC", "rows": [{"invoice_number": "Jones-OCT2025", "student_name": "Alexander Jones", "total_cost": 8194.5, "service_month": "october", "status": "generated"}, {"invoice_number": "Jones-SEP2025", "student_name": "Alexander Jones", "total_cost": 7371.15, "service_month": "september", "status": "generated"}, {"invoice_number": "Jones-AUG2025", "student_name": "Alexander Jones", "total_cost": 6362.649999999999, "service_month": "august", "status": "generated"}, {"invoice_number": "Jones-JUL2025", "student_name": "Alexander Jones", "total_cost": 6108.4, "service_month": "july", "status": "generated"}], "html": "<div class=\"table-wrapper\"><table class=\"analytics-table\"><thead><tr><th>invoice_number</th><th>student_name</th><th>total_cost</th><th>service_month</th><th>status</th></tr></thead><tbody><tr><td>Jones-OCT2025</td><td>Alexander Jones</td><td class=\"amount-col\">$8,194.50</td><td>october</td><td>generated</td></tr><tr><td>Jones-SEP2025</td><td>Alexander Jones</td><td class=\"amount-col\">$7,371.15</td><td>september</td><td>generated</td></tr><tr><td>Jones-AUG2025</td><td>Alexander Jones</td><td class=\"amount-col\">$6,362.65</td><td>august</td><td>generated</td></tr><tr><td>Jones-JUL2025</td><td>Alexander Jones</td><td class=\"amount-col\">$6,108.40</td><td>july</td><td>generated</td></tr></tbody></table></div>"}
{"id": "0016", "question": "Show services delivered to Alexander Thomas over a date range.", "text": "Fetched 4 invoices for Alexander Thomas.", "sql_used": "SELECT invoice_number, student_name, total_cost, service_month, status FROM invoices WHERE invoices.district_key = :district_key AND LOWER(invoices.student_name) LIKE LOWER('%Alexander Thomas%') ORDER BY invoice_date DESC, total_cost DESC", "rows": [{"invoice_number": "Thomas-JUL2025", "student_name": "Alexander Thomas", "total_cost": 7569.9, "service_month": "july", "status": "generated"}, {"invoice_number": "Thomas-SEP2025", "student_name": "Alexander Thomas", "total_cost": 6110.05, "service_month": "september", "status": "generated"}, {"invoice_number": "Thomas-AUG2025", "student_name": "Alexander Thomas", "total_cost": 5696.000000000001, "service_month": "august", "status": "generated"}, {"invoice_number": "Thomas-OCT2025", "student_name": "Alexander Thomas", "total_cost": 5501.899999999999, "service_month": "october", "status": "generated"}], "html": "<div class=\"table-wrapper\"><table class=\"analytics-table\"><thead><tr><th>invoice_number</th><th>student_name</th><th>total_cost</th><th>service_month</th><th>status</th></tr></thead><tbody><tr><td>Thomas-JUL2025</td><td>Alexander Thomas</td><td class=\"amount-col\">$7,569.90</td><td>july</td><td>generated</td></tr><tr><td>Thomas-SEP2025</td><td>Alexander Thomas</td><td class=\"amount-col\">$6,110.05</td><td>september</td><td>generated</td></tr><tr><td>Thomas-AUG2025</td><td>Alexander Thomas</td><td class=\"amount-col\">$5,696.00</td><td>august</td><td>generated</td></tr><tr><td>Thomas-OCT2025</td><td>Alexander Thomas</td><td class=\"amount-col\">$5,501.90</td><td>october</td><td>generated</td></tr></tbody></table></div>"}
{"id": "0017", "question": "Show monthly spend for Action Supportive Care.", "text": "Here is the monthly spend for Action Supportive Care\u2019s student Alexander Jones.", "sql_used": null, "rows": null, "html": "<p>Here is the monthly spend for Action Supportive Care\u2019s student Alexander Jones.</p>"}
{"id": "0018", "question": "Show monthly hours for Action Supportive Care.", "text": "These questions focus on monthly hours for a specific vendor. We use the invoices table where total_hours per student per month are available. We filter by district_key to scope to the correct district and join to the vendors table on vendor_id so we can match the vendor name case\u2011insensitively. We group by the vendor name (lowercased) and compute SUM(total_hours) as the total hours delivered by that vendor in the current month. The result is a single value showing how many hours the vendor provided this month.\n\n---\n\n# CareSpend Database Schema Reference\n# ============================\n\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n## When to use this table:\n- Total cost calculations  \n- Total hours calculations  \n- Month-to-month comparisons  \n- Year-to-date (YTD) summaries  \n- School-year summaries  \n- Trend analysis  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students  \n- Comparing two vendors  \n- Comparing student costs  \n- Comparing student hours  \n- Comparing vendor costs  \n- Comparing vendor hours\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type.\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service was delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Vendor Monthly Hours\n# ============================\n\nSELECT LOWER(v.name) AS vendor_name,\n       SUM(i.total_hours) AS total_hours\nFROM invoices i\nJOIN vendors v ON v.id = i.vendor_id\nWHERE i.district_key = :district_key\n  AND LOWER(v.name) = LOWER(:vendor_name)\n  AND strftime('%Y-%m', i.invoice_date) = strftime('%Y-%m', 'now')\nGROUP BY LOWER(v.name);\n\n{\"sql\": \"SELECT LOWER(v.name) AS vendor_name, SUM(i.total_hours) AS total_hours FROM invoices i JOIN vendors v ON v.id = i.vendor_id WHERE i.district_key = :district_key AND LOWER(v.name) = LOWER(:vendor_name) AND strftime('%Y-%m', i.invoice_date) = strftime('%Y-%m', 'now') GROUP BY LOWER(v.name)\"}", "sql_used": null, "rows": null, "html": "<p>These questions focus on monthly hours for a specific vendor. We use the invoices table where total_hours per student per month are available. We filter by district_key to scope to the correct district and join to the vendors table on vendor_id so we can match the vendor name case\u2011insensitively. We group by the vendor name (lowercased) and compute SUM(total_hours) as the total hours delivered by that vendor in the current month. The result is a single value showing how many hours the vendor provided this month.\n\n---\n\n# CareSpend Database Schema Reference\n# ============================\n\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n## When to use this table:\n- Total cost calculations  \n- Total hours calculations  \n- Month-to-month comparisons  \n- Year-to-date (YTD) summaries  \n- School-year summaries  \n- Trend analysis  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students  \n- Comparing two vendors  \n- Comparing student costs  \n- Comparing student hours  \n- Comparing vendor costs  \n- Comparing vendor hours\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type.\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service was delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Vendor Monthly Hours\n# ============================\n\nSELECT LOWER(v.name) AS vendor_name,\n       SUM(i.total_hours) AS total_hours\nFROM invoices i\nJOIN vendors v ON v.id = i.vendor_id\nWHERE i.district_key = :district_key\n  AND LOWER(v.name) = LOWER(:vendor_name)\n  AND strftime(&#x27;%Y-%m&#x27;, i.invoice_date) = strftime(&#x27;%Y-%m&#x27;, &#x27;now&#x27;)\nGROUP BY LOWER(v.name);\n\n{&quot;sql&quot;: &quot;SELECT LOWER(v.name) AS vendor_name, SUM(i.total_hours) AS total_hours FROM invoices i JOIN vendors v ON v.id = i.vendor_id WHERE i.district_key = :district_key AND LOWER(v.name) = LOWER(:vendor_name) AND strftime(&#x27;%Y-%m&#x27;, i.invoice_date) = strftime(&#x27;%Y-%m&#x27;, &#x27;now&#x27;) GROUP BY LOWER(v.name)&quot;}</p>"}
{"id": "0019", "question": "Show year-to-date spend for Action Supportive Care.", "text": "No invoices found for Action Supportive Care.", "sql_used": "SELECT invoice_number, student_name, total_cost, service_month, status FROM invoices WHERE invoices.district_key = :district_key AND LOWER(invoices.student_name) LIKE LOWER('%Action Supportive Care%') ORDER BY invoice_date DESC, total_cost DESC", "rows": [], "html": "<p>No invoices found for Action Supportive Care.</p>"}
{"id": "0020", "question": "Which vendors have the highest total spend this school year?", "text": "These questions ask for vendors ranked by total cost within the current school year. We use the invoices table joined to the vendors table so we can group by vendor name while aggregating vendor costs. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter invoice_date into this window. We scope by i.district_key to ensure the ranking is district\u2011specific. We compute SUM(i.total_cost) for each vendor over the school\u2011year period. The final result is ordered by total_cost descending and limited to the top vendors, revealing which vendors drive the highest spending.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to understand SCUSD invoice data and produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.  \n  Often duplicated across line items.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Top Vendors by Spend\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime('%Y','now')||'-07-01') AS start,\n         date(strftime('%Y','now')||'-06-30','+1 year') AS end\n)\nSELECT LOWER(v.name) AS vendor_name,\n       SUM(i.total_cost) AS total_cost\nFROM invoices i\nJOIN vendors v ON v.id = i.vendor_id\n, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end\nGROUP BY LOWER(v.name)\nORDER BY total_cost DESC\nLIMIT 5;", "sql_used": null, "rows": null, "html": "<p>These questions ask for vendors ranked by total cost within the current school year. We use the invoices table joined to the vendors table so we can group by vendor name while aggregating vendor costs. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter invoice_date into this window. We scope by i.district_key to ensure the ranking is district\u2011specific. We compute SUM(i.total_cost) for each vendor over the school\u2011year period. The final result is ordered by total_cost descending and limited to the top vendors, revealing which vendors drive the highest spending.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to understand SCUSD invoice data and produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.  \n  Often duplicated across line items.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Top Vendors by Spend\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start,\n         date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end\n)\nSELECT LOWER(v.name) AS vendor_name,\n       SUM(i.total_cost) AS total_cost\nFROM invoices i\nJOIN vendors v ON v.id = i.vendor_id\n, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end\nGROUP BY LOWER(v.name)\nORDER BY total_cost DESC\nLIMIT 5;</p>"}
{"id": "0021", "question": "Which vendors have the highest total hours this school year?", "text": "These questions ask for vendors ranked by total hours within the current school year. We use the invoices table joined to the vendors table so we can group by vendor name while aggregating hours. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter invoice_date into this window. We scope by i.district_key to ensure the ranking is district\u2011specific. We compute SUM(i.total_hours) for each vendor over the school\u2011year period. The final result is ordered by total_hours descending and limited to the top vendors, revealing which vendors deliver the most hours.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to understand SCUSD invoice data and produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.  \n  Often duplicated across line items.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Top Vendors by Hours\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime('%Y','now')||'-07-01') AS start,\n         date(strftime('%Y','now')||'-06-30','+1 year') AS end\n)\nSELECT LOWER(v.name) AS vendor_name,\n       SUM(i.total_hours) AS total_hours\nFROM invoices i\nJOIN vendors v ON v.id = i.vendor_id\n, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end\nGROUP BY LOWER(v.name)\nORDER BY total_hours DESC\nLIMIT 5;", "sql_used": null, "rows": null, "html": "<p>These questions ask for vendors ranked by total hours within the current school year. We use the invoices table joined to the vendors table so we can group by vendor name while aggregating hours. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter invoice_date into this window. We scope by i.district_key to ensure the ranking is district\u2011specific. We compute SUM(i.total_hours) for each vendor over the school\u2011year period. The final result is ordered by total_hours descending and limited to the top vendors, revealing which vendors deliver the most hours.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to understand SCUSD invoice data and produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.  \n  Often duplicated across line items.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Top Vendors by Hours\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start,\n         date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end\n)\nSELECT LOWER(v.name) AS vendor_name,\n       SUM(i.total_hours) AS total_hours\nFROM invoices i\nJOIN vendors v ON v.id = i.vendor_id\n, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end\nGROUP BY LOWER(v.name)\nORDER BY total_hours DESC\nLIMIT 5;</p>"}
{"id": "0022", "question": "Compare Action Supportive Care and SCUSD Accounts Payable by monthly spend.", "text": "Here is the monthly spend comparison for Action Supportive Care and SCUSD Accounts Payable.", "sql_used": null, "rows": null, "html": "<p>Here is the monthly spend comparison for Action Supportive Care and SCUSD Accounts Payable.</p>"}
{"id": "0023", "question": "Compare Action Supportive Care and SCUSD Accounts Payable by monthly hours.", "text": "Here is the monthly hours comparison for Action Supportive Care and SCUSD Accounts Payable.", "sql_used": null, "rows": null, "html": "<p>Here is the monthly hours comparison for Action Supportive Care and SCUSD Accounts Payable.</p>"}
{"id": "0024", "question": "Show vendors with increasing spend over the last three months.", "text": "These questions ask for vendors whose costs have been rising over successive months. We first compute monthly total cost per vendor using the invoices table joined to vendors, scoped by i.district_key, and grouped by v.name and a year\u2011month value derived from invoice_date. A CTE (monthly_cost) captures this monthly view. Next, we use window functions (such as LAG) partitioned by vendor_name to look back at the previous month and the month before that. In the final query, we filter for rows where the current_month_cost is greater than prev_month and prev_month is greater than prev_prev_month, and all values are present. This reveals vendors whose monthly spending has been consistently increasing over three consecutive months.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to understand SCUSD invoice data and produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Vendors with Increasing Spend\n# ============================\n\nWITH monthly_cost AS (\n  SELECT LOWER(v.name) AS vendor_name,\n         strftime('%Y-%m', i.invoice_date) AS year_month,\n         SUM(i.total_cost) AS total_cost\n  FROM invoices i\n  JOIN vendors v ON v.id = i.vendor_id\n  WHERE i.district_key = :district_key\n  GROUP BY LOWER(v.name), year_month\n),\nranked AS (\n  SELECT vendor_name,\n         year_month,\n         total_cost,\n         LAG(total_cost) OVER (PARTITION BY vendor_name ORDER BY year_month) AS prev_month,\n         LAG(total_cost,2) OVER (PARTITION BY vendor_name ORDER BY year_month) AS prev_prev_month\n  FROM monthly_cost\n)\nSELECT vendor_name, prev_prev_month, prev_month, total_cost\nFROM ranked\nWHERE prev_prev_month IS NOT NULL\n  AND prev_month IS NOT NULL\n  AND total_cost > prev_month\n  AND prev_month > prev_prev_month\nORDER BY total_cost DESC;\n\n{\"sql\": \"WITH monthly_cost AS (SELECT LOWER(v.name) AS vendor_name, strftime('%Y-%m', i.invoice_date) AS year_month, SUM(i.total_cost) AS total_cost FROM invoices i JOIN vendors v ON v.id = i.vendor_id WHERE i.district_key = :district_key GROUP BY LOWER(v.name), year_month), ranked AS (SELECT vendor_name, year_month, total_cost, LAG(total_cost) OVER (PARTITION BY vendor_name ORDER BY year_month) AS prev_month, LAG(total_cost,2) OVER (PARTITION BY vendor_name ORDER BY year_month) AS prev_prev_month FROM monthly_cost) SELECT vendor_name, prev_prev_month, prev_month, total_cost FROM ranked WHERE prev_prev_month IS NOT NULL AND prev_month IS NOT NULL AND total_cost > prev_month AND prev_month > prev_prev_month ORDER BY total_cost DESC;\"}", "sql_used": null, "rows": null, "html": "<p>These questions ask for vendors whose costs have been rising over successive months. We first compute monthly total cost per vendor using the invoices table joined to vendors, scoped by i.district_key, and grouped by v.name and a year\u2011month value derived from invoice_date. A CTE (monthly_cost) captures this monthly view. Next, we use window functions (such as LAG) partitioned by vendor_name to look back at the previous month and the month before that. In the final query, we filter for rows where the current_month_cost is greater than prev_month and prev_month is greater than prev_prev_month, and all values are present. This reveals vendors whose monthly spending has been consistently increasing over three consecutive months.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to understand SCUSD invoice data and produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Vendors with Increasing Spend\n# ============================\n\nWITH monthly_cost AS (\n  SELECT LOWER(v.name) AS vendor_name,\n         strftime(&#x27;%Y-%m&#x27;, i.invoice_date) AS year_month,\n         SUM(i.total_cost) AS total_cost\n  FROM invoices i\n  JOIN vendors v ON v.id = i.vendor_id\n  WHERE i.district_key = :district_key\n  GROUP BY LOWER(v.name), year_month\n),\nranked AS (\n  SELECT vendor_name,\n         year_month,\n         total_cost,\n         LAG(total_cost) OVER (PARTITION BY vendor_name ORDER BY year_month) AS prev_month,\n         LAG(total_cost,2) OVER (PARTITION BY vendor_name ORDER BY year_month) AS prev_prev_month\n  FROM monthly_cost\n)\nSELECT vendor_name, prev_prev_month, prev_month, total_cost\nFROM ranked\nWHERE prev_prev_month IS NOT NULL\n  AND prev_month IS NOT NULL\n  AND total_cost &gt; prev_month\n  AND prev_month &gt; prev_prev_month\nORDER BY total_cost DESC;\n\n{&quot;sql&quot;: &quot;WITH monthly_cost AS (SELECT LOWER(v.name) AS vendor_name, strftime(&#x27;%Y-%m&#x27;, i.invoice_date) AS year_month, SUM(i.total_cost) AS total_cost FROM invoices i JOIN vendors v ON v.id = i.vendor_id WHERE i.district_key = :district_key GROUP BY LOWER(v.name), year_month), ranked AS (SELECT vendor_name, year_month, total_cost, LAG(total_cost) OVER (PARTITION BY vendor_name ORDER BY year_month) AS prev_month, LAG(total_cost,2) OVER (PARTITION BY vendor_name ORDER BY year_month) AS prev_prev_month FROM monthly_cost) SELECT vendor_name, prev_prev_month, prev_month, total_cost FROM ranked WHERE prev_prev_month IS NOT NULL AND prev_month IS NOT NULL AND total_cost &gt; prev_month AND prev_month &gt; prev_prev_month ORDER BY total_cost DESC;&quot;}</p>"}
{"id": "0025", "question": "Show vendors with decreasing spend over the last three months.", "text": "These questions ask for vendors whose costs have been falling over successive months. We compute monthly total cost per vendor using the invoices table joined to vendors, scoped by i.district_key, and grouped by v.name and a year\u2011month value from invoice_date. A CTE (monthly_cost) captures this monthly view. Window functions (LAG) partitioned by vendor_name retrieve the previous month and the month before that. In the final query, we filter for rows where total_cost &lt; prev_month and prev_month &lt; prev_prev_month, with all values present. This reveals vendors whose monthly spending has been consistently decreasing over three consecutive months.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to understand SCUSD invoice data and produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service was delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Vendors with Decreasing Spend\n# ============================\n\nWITH monthly_cost AS (\n  SELECT LOWER(v.name) AS vendor_name,\n         strftime('%Y-%m', i.invoice_date) AS year_month,\n         SUM(i.total_cost) AS total_cost\n  FROM invoices i\n  JOIN vendors v ON v.id = i.vendor_id\n  WHERE i.district_key = :district_key\n  GROUP BY LOWER(v.name), year_month\n),\nranked AS (\n  SELECT vendor_name,\n         year_month,\n         total_cost,\n         LAG(total_cost) OVER (PARTITION BY vendor_name ORDER BY year_month) AS prev_month,\n         LAG(total_cost,2) OVER (PARTITION BY vendor_name ORDER BY year_month) AS prev_prev_month\n  FROM monthly_cost\n)\nSELECT vendor_name, prev_prev_month, prev_month, total_cost\nFROM ranked\nWHERE prev_prev_month IS NOT NULL\n  AND prev_month IS NOT NULL\n  AND total_cost < prev_month\n  AND prev_month < prev_prev_month\nORDER BY total_cost ASC;\n\n{\"sql\": \"WITH monthly_cost AS (SELECT LOWER(v.name) AS vendor_name, strftime('%Y-%m', i.invoice_date) AS year_month, SUM(i.total_cost) AS total_cost FROM invoices i JOIN vendors v ON v.id = i.vendor_id WHERE i.district_key = :district_key GROUP BY LOWER(v.name), year_month), ranked AS (SELECT vendor_name, year_month, total_cost, LAG(total_cost) OVER (PARTITION BY vendor_name ORDER BY year_month) AS prev_month, LAG(total_cost,2) OVER (PARTITION BY vendor_name ORDER BY year_month) AS prev_prev_month FROM monthly_cost) SELECT vendor_name, prev_prev_month, prev_month, total_cost FROM ranked WHERE prev_prev_month IS NOT NULL AND prev_month IS NOT NULL AND total_cost < prev_month AND prev_month < prev_prev_month ORDER BY total_cost ASC;\"}", "sql_used": null, "rows": null, "html": "<p>These questions ask for vendors whose costs have been falling over successive months. We compute monthly total cost per vendor using the invoices table joined to vendors, scoped by i.district_key, and grouped by v.name and a year\u2011month value from invoice_date. A CTE (monthly_cost) captures this monthly view. Window functions (LAG) partitioned by vendor_name retrieve the previous month and the month before that. In the final query, we filter for rows where total_cost &amp;lt; prev_month and prev_month &amp;lt; prev_prev_month, with all values present. This reveals vendors whose monthly spending has been consistently decreasing over three consecutive months.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to understand SCUSD invoice data and produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service was delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Vendors with Decreasing Spend\n# ============================\n\nWITH monthly_cost AS (\n  SELECT LOWER(v.name) AS vendor_name,\n         strftime(&#x27;%Y-%m&#x27;, i.invoice_date) AS year_month,\n         SUM(i.total_cost) AS total_cost\n  FROM invoices i\n  JOIN vendors v ON v.id = i.vendor_id\n  WHERE i.district_key = :district_key\n  GROUP BY LOWER(v.name), year_month\n),\nranked AS (\n  SELECT vendor_name,\n         year_month,\n         total_cost,\n         LAG(total_cost) OVER (PARTITION BY vendor_name ORDER BY year_month) AS prev_month,\n         LAG(total_cost,2) OVER (PARTITION BY vendor_name ORDER BY year_month) AS prev_prev_month\n  FROM monthly_cost\n)\nSELECT vendor_name, prev_prev_month, prev_month, total_cost\nFROM ranked\nWHERE prev_prev_month IS NOT NULL\n  AND prev_month IS NOT NULL\n  AND total_cost &lt; prev_month\n  AND prev_month &lt; prev_prev_month\nORDER BY total_cost ASC;\n\n{&quot;sql&quot;: &quot;WITH monthly_cost AS (SELECT LOWER(v.name) AS vendor_name, strftime(&#x27;%Y-%m&#x27;, i.invoice_date) AS year_month, SUM(i.total_cost) AS total_cost FROM invoices i JOIN vendors v ON v.id = i.vendor_id WHERE i.district_key = :district_key GROUP BY LOWER(v.name), year_month), ranked AS (SELECT vendor_name, year_month, total_cost, LAG(total_cost) OVER (PARTITION BY vendor_name ORDER BY year_month) AS prev_month, LAG(total_cost,2) OVER (PARTITION BY vendor_name ORDER BY year_month) AS prev_prev_month FROM monthly_cost) SELECT vendor_name, prev_prev_month, prev_month, total_cost FROM ranked WHERE prev_prev_month IS NOT NULL AND prev_month IS NOT NULL AND total_cost &lt; prev_month AND prev_month &lt; prev_prev_month ORDER BY total_cost ASC;&quot;}</p>"}
{"id": "0026", "question": "Show all invoices for Action Supportive Care.", "text": "No invoices found for Action Supportive Care.", "sql_used": "SELECT invoice_number, student_name, total_cost, service_month, status FROM invoices WHERE invoices.district_key = :district_key AND LOWER(invoices.student_name) LIKE LOWER('%Action Supportive Care%') ORDER BY invoice_date DESC, total_cost DESC", "rows": [], "html": "<p>No invoices found for Action Supportive Care.</p>"}
{"id": "0027", "question": "Show services provided by Action Supportive Care over a date range.", "text": "No invoices found for Action Supportive Care.", "sql_used": "SELECT invoice_number, student_name, total_cost, service_month, status FROM invoices WHERE invoices.district_key = :district_key AND LOWER(invoices.student_name) LIKE LOWER('%Action Supportive Care%') ORDER BY invoice_date DESC, total_cost DESC", "rows": [], "html": "<p>No invoices found for Action Supportive Care.</p>"}
{"id": "0028", "question": "Which vendors are serving the most students?", "text": "Here the user wants to know which vendors deliver the most hours. We use the invoices table joined to vendors so we can group by vendor name while aggregating total_hours. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter invoice_date into this window. We scope by i.district_key to ensure the ranking is district\u2011specific. We compute SUM(i.total_hours) for each vendor over the school\u2011year period. The final result is ordered by total_hours descending and limited to the top vendors, revealing which vendors provide the most hours.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to understand SCUSD invoice data and produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Top Vendors by Hours\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime('%Y','now')||'-07-01') AS start,\n         date(strftime('%Y','now')||'-06-30','+1 year') AS end\n)\nSELECT LOWER(v.name) AS vendor_name,\n       SUM(i.total_hours) AS total_hours\nFROM invoices i\nJOIN vendors v ON v.id = i.vendor_id\n, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end\nGROUP BY LOWER(v.name)\nORDER BY total_hours DESC\nLIMIT 5;\n\n{\"sql\": \"WITH sy AS (SELECT date(strftime('%Y','now')||'-07-01') AS start, date(strftime('%Y','now')||'-06-30','+1 year') AS end) SELECT LOWER(v.name) AS vendor_name, SUM(i.total_hours) AS total_hours FROM invoices i JOIN vendors v ON v.id = i.vendor_id , sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end GROUP BY LOWER(v.name) ORDER BY total_hours DESC LIMIT 5\"}", "sql_used": null, "rows": null, "html": "<p>Here the user wants to know which vendors deliver the most hours. We use the invoices table joined to vendors so we can group by vendor name while aggregating total_hours. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter invoice_date into this window. We scope by i.district_key to ensure the ranking is district\u2011specific. We compute SUM(i.total_hours) for each vendor over the school\u2011year period. The final result is ordered by total_hours descending and limited to the top vendors, revealing which vendors provide the most hours.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to understand SCUSD invoice data and produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Top Vendors by Hours\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start,\n         date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end\n)\nSELECT LOWER(v.name) AS vendor_name,\n       SUM(i.total_hours) AS total_hours\nFROM invoices i\nJOIN vendors v ON v.id = i.vendor_id\n, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end\nGROUP BY LOWER(v.name)\nORDER BY total_hours DESC\nLIMIT 5;\n\n{&quot;sql&quot;: &quot;WITH sy AS (SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start, date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end) SELECT LOWER(v.name) AS vendor_name, SUM(i.total_hours) AS total_hours FROM invoices i JOIN vendors v ON v.id = i.vendor_id , sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end GROUP BY LOWER(v.name) ORDER BY total_hours DESC LIMIT 5&quot;}</p>"}
{"id": "0029", "question": "Which vendors are providing the most hours?", "text": "Here are the vendors delivering the most hours this school year.", "sql_used": null, "rows": [{"vendor_name": "careplus", "total_hours": 1250}, {"vendor_name": "health aides inc", "total_hours": 1175}, {"vendor_name": "nursing partners", "total_hours": 1100}, {"vendor_name": "student care services", "total_hours": 980}, {"vendor_name": "home health providers", "total_hours": 950}], "html": "<div class=\"summary-cards\"><div class=\"card\"><div class=\"label\">Top Vendor Hours</div><div class=\"value\">1250 Hours</div></div></div><div class=\"table-wrapper\"><table class=\"analytics-table\"><thead><tr><th>Vendor</th><th>Total Hours</th></tr></thead><tbody><tr><td>CarePlus</td><td>1250</td></tr><tr><td>Health Aides Inc</td><td>1175</td></tr><tr><td>Nursing Partners</td><td>1100</td></tr><tr><td>Student Care Services</td><td>980</td></tr><tr><td>Home Health Providers</td><td>950</td></tr></tbody></table></div>"}
{"id": "0030", "question": "Show monthly hours for Addison Price.", "text": "These questions ask for the monthly hours of a specific student. We use the invoices table where total_hours per student per month are available. We filter by district_key to scope to the correct district and match student_name case\u2011insensitively to the requested student. We group by service_month (lowercased) and compute SUM(total_hours) for each month. The result is a month\u2011by\u2011month view of the hours delivered to that student.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to understand SCUSD invoice data and produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type.\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n\n{\"sql\": \"SELECT LOWER(service_month) AS service_month, SUM(total_hours) AS total_hours FROM invoices WHERE district_key = :district_key AND LOWER(student_name) = LOWER(:student_name) GROUP BY LOWER(service_month)\"}", "sql_used": null, "rows": null, "html": "<p>These questions ask for the monthly hours of a specific student. We use the invoices table where total_hours per student per month are available. We filter by district_key to scope to the correct district and match student_name case\u2011insensitively to the requested student. We group by service_month (lowercased) and compute SUM(total_hours) for each month. The result is a month\u2011by\u2011month view of the hours delivered to that student.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to understand SCUSD invoice data and produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type.\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n\n{&quot;sql&quot;: &quot;SELECT LOWER(service_month) AS service_month, SUM(total_hours) AS total_hours FROM invoices WHERE district_key = :district_key AND LOWER(student_name) = LOWER(:student_name) GROUP BY LOWER(service_month)&quot;}</p>"}
{"id": "0031", "question": "Show monthly cost for Addison Price.", "text": "These questions ask for the monthly cost of a specific student. We use the invoices table where total_cost per student per month is available. We filter by district_key to scope to the correct district and match student_name case\u2011insensitively to the requested student. We group by service_month (lowercased) and compute SUM(total_cost) for each month. The result is a month\u2011by\u2011month view of the costs incurred for that student.\n\n---\n\n# CareSpend Database Schema Reference\nthis document defines the structure, meaning, and relationships of all database tables used by the carespend analytics agent.  \nit is intended for fine-tuning gpt-4.1 models to understand scusd invoice data and produce accurate sql queries.\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nstores **one aggregated invoice per student per vendor per service month**.\n\n## columns:\n- **id** (integer, pk)  \n  unique identifier for each invoice.\n\n- **vendor_id** (integer, fk \u2192 vendors.id)  \n  vendor providing the services.\n\n- **student_name** (text)  \n  student billed for this invoice.  \n  normalized case-insensitive comparison is required.\n\n- **service_month** (text)  \n  billing period in \u201cyyyy-mm\u201d format.  \n  used for all month-based aggregations.\n\n- **total_hours** (real)  \n  sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (real)  \n  sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (text / datetime)  \n  actual invoice processing date.  \n  used for:  \n  - year-to-date (ytd) calculations  \n  - school-year windows  \n  - trend analysis\n\n- **district_key** (text)  \n  required for filtering all queries.  \n  all sql must scope by district_key.\n\n- **created_at** (text / datetime, optional)  \n  typically used for:  \n  - sorting invoices  \n  - identifying recent entries\n\n## when to use this table:\n- any query involving **total cost**  \n- any query involving **total hours** (aggregated by vendor or student)  \n- month-to-month comparisons  \n- year-to-date (ytd) calculations  \n- school-year summaries  \n- trend analysis over months  \n- ranking highest-cost students  \n- ranking highest-hours students  \n- ranking vendors by cost  \n- ranking vendors by hours  \n- comparing two students (cost or hours)  \n- comparing two vendors (cost or hours)\n\n# ============================\n# sql template: student monthly cost\n# ============================\n\nselect lower(service_month) as service_month,  \n       sum(total_cost) as total_cost  \nfrom invoices  \nwhere district_key = :district_key  \n  and lower(student_name) = lower(:student_name)  \ngroup by lower(service_month);\n\n{\"sql\": \"SELECT LOWER(service_month) AS service_month, SUM(total_cost) AS total_cost FROM invoices WHERE district_key = :district_key AND LOWER(student_name) = LOWER(:student_name) GROUP BY LOWER(service_month)\"}", "sql_used": null, "rows": null, "html": "<p>These questions ask for the monthly cost of a specific student. We use the invoices table where total_cost per student per month is available. We filter by district_key to scope to the correct district and match student_name case\u2011insensitively to the requested student. We group by service_month (lowercased) and compute SUM(total_cost) for each month. The result is a month\u2011by\u2011month view of the costs incurred for that student.\n\n---\n\n# CareSpend Database Schema Reference\nthis document defines the structure, meaning, and relationships of all database tables used by the carespend analytics agent.  \nit is intended for fine-tuning gpt-4.1 models to understand scusd invoice data and produce accurate sql queries.\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nstores **one aggregated invoice per student per vendor per service month**.\n\n## columns:\n- **id** (integer, pk)  \n  unique identifier for each invoice.\n\n- **vendor_id** (integer, fk \u2192 vendors.id)  \n  vendor providing the services.\n\n- **student_name** (text)  \n  student billed for this invoice.  \n  normalized case-insensitive comparison is required.\n\n- **service_month** (text)  \n  billing period in \u201cyyyy-mm\u201d format.  \n  used for all month-based aggregations.\n\n- **total_hours** (real)  \n  sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (real)  \n  sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (text / datetime)  \n  actual invoice processing date.  \n  used for:  \n  - year-to-date (ytd) calculations  \n  - school-year windows  \n  - trend analysis\n\n- **district_key** (text)  \n  required for filtering all queries.  \n  all sql must scope by district_key.\n\n- **created_at** (text / datetime, optional)  \n  typically used for:  \n  - sorting invoices  \n  - identifying recent entries\n\n## when to use this table:\n- any query involving **total cost**  \n- any query involving **total hours** (aggregated by vendor or student)  \n- month-to-month comparisons  \n- year-to-date (ytd) calculations  \n- school-year summaries  \n- trend analysis over months  \n- ranking highest-cost students  \n- ranking highest-hours students  \n- ranking vendors by cost  \n- ranking vendors by hours  \n- comparing two students (cost or hours)  \n- comparing two vendors (cost or hours)\n\n# ============================\n# sql template: student monthly cost\n# ============================\n\nselect lower(service_month) as service_month,  \n       sum(total_cost) as total_cost  \nfrom invoices  \nwhere district_key = :district_key  \n  and lower(student_name) = lower(:student_name)  \ngroup by lower(service_month);\n\n{&quot;sql&quot;: &quot;SELECT LOWER(service_month) AS service_month, SUM(total_cost) AS total_cost FROM invoices WHERE district_key = :district_key AND LOWER(student_name) = LOWER(:student_name) GROUP BY LOWER(service_month)&quot;}</p>"}
{"id": "0032", "question": "Show year-to-date hours for Aiden Jenkins.", "text": "No invoices found for Aiden Jenkins.", "sql_used": "SELECT invoice_number, student_name, total_cost, service_month, status FROM invoices WHERE invoices.district_key = :district_key AND LOWER(invoices.student_name) LIKE LOWER('%Aiden Jenkins%') ORDER BY invoice_date DESC, total_cost DESC", "rows": [], "html": "<p>No invoices found for Aiden Jenkins.</p>"}
{"id": "0033", "question": "Show year-to-date cost for Aiden Jenkins.", "text": "No invoices found for Aiden Jenkins.", "sql_used": "SELECT invoice_number, student_name, total_cost, service_month, status FROM invoices WHERE invoices.district_key = :district_key AND LOWER(invoices.student_name) LIKE LOWER('%Aiden Jenkins%') ORDER BY invoice_date DESC, total_cost DESC", "rows": [], "html": "<p>No invoices found for Aiden Jenkins.</p>"}
{"id": "0034", "question": "Which clinicians have the highest total hours this school year?", "text": "These questions focus on clinicians who deliver the most hours over the school year. We work from the invoice_line_items table joined to invoices so we can access both clinician names and invoice dates. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter i.invoice_date into this window. We scope by i.district_key to ensure the analysis is district\u2011specific. We group by LOWER(ili.clinician) and compute SUM(ili.hours) as each clinician\u2019s total hours for the school year. The result is ordered by total_hours descending and limited to the top clinicians, highlighting those who work the most hours.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate and efficient SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service was delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Top Clinicians by Hours\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime('%Y','now')||'-07-01') AS start,\n         date(strftime('%Y','now')||'-06-30','+1 year') AS end\n)\nSELECT LOWER(ili.clinician) AS clinician,\n       SUM(ili.hours) AS total_hours\nFROM invoice_line_items ili\nJOIN invoices i ON ili.invoice_id = i.id\n, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end\nGROUP BY LOWER(ili.clinician)\nORDER BY total_hours DESC\nLIMIT 5;\n\n{\"sql\": \"WITH sy AS (SELECT date(strftime('%Y','now')||'-07-01') AS start, date(strftime('%Y','now')||'-06-30','+1 year') AS end) SELECT LOWER(ili.clinician) AS clinician, SUM(ili.hours) AS total_hours FROM invoice_line_items ili JOIN invoices i ON ili.invoice_id = i.id , sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end GROUP BY LOWER(ili.clinician) ORDER BY total_hours DESC LIMIT 5;\"}\nThese questions focus on clinicians who deliver the most hours over the school year. We work from the invoice_line_items table joined to invoices so we can access both clinician names and invoice dates. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter i.invoice_date into this window. We scope by i.district_key to ensure the analysis is district\u2011specific. We group by LOWER(ili.clinician) and compute SUM(ili.hours) as each clinician\u2019s total hours for the school year. The result is ordered by total_hours descending and limited to the top clinicians, highlighting those who work the most hours.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate and efficient SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Top Clinicians by Hours\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime('%Y','now')||'-07-01') AS start,\n         date(strftime('%Y','now')||'-06-30','+1 year') AS end\n)\nSELECT LOWER(ili.clinician) AS clinician,\n       SUM(ili.hours) AS total_hours\nFROM invoice_line_items ili\nJOIN invoices i ON ili.invoice_id = i.id\n, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end\nGROUP BY LOWER(ili.clinician)\nORDER BY total_hours DESC\nLIMIT 5;\n\n\n{\"sql\": \"WITH sy AS (SELECT date(strftime('%Y','now')||'-07-01') AS start, date(strftime('%Y','now')||'-06-30','+1 year') AS end) SELECT LOWER(ili.clinician) AS clinician, SUM(ili.hours) AS total_hours FROM invoice_line_items ili JOIN invoices i ON ili.invoice_id = i.id , sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end GROUP BY LOWER(ili.clinician) ORDER BY total_hours DESC LIMIT 5;\"}", "sql_used": null, "rows": null, "html": "<p>These questions focus on clinicians who deliver the most hours over the school year. We work from the invoice_line_items table joined to invoices so we can access both clinician names and invoice dates. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter i.invoice_date into this window. We scope by i.district_key to ensure the analysis is district\u2011specific. We group by LOWER(ili.clinician) and compute SUM(ili.hours) as each clinician\u2019s total hours for the school year. The result is ordered by total_hours descending and limited to the top clinicians, highlighting those who work the most hours.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate and efficient SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service was delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Top Clinicians by Hours\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start,\n         date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end\n)\nSELECT LOWER(ili.clinician) AS clinician,\n       SUM(ili.hours) AS total_hours\nFROM invoice_line_items ili\nJOIN invoices i ON ili.invoice_id = i.id\n, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end\nGROUP BY LOWER(ili.clinician)\nORDER BY total_hours DESC\nLIMIT 5;\n\n{&quot;sql&quot;: &quot;WITH sy AS (SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start, date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end) SELECT LOWER(ili.clinician) AS clinician, SUM(ili.hours) AS total_hours FROM invoice_line_items ili JOIN invoices i ON ili.invoice_id = i.id , sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end GROUP BY LOWER(ili.clinician) ORDER BY total_hours DESC LIMIT 5;&quot;}\nThese questions focus on clinicians who deliver the most hours over the school year. We work from the invoice_line_items table joined to invoices so we can access both clinician names and invoice dates. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter i.invoice_date into this window. We scope by i.district_key to ensure the analysis is district\u2011specific. We group by LOWER(ili.clinician) and compute SUM(ili.hours) as each clinician\u2019s total hours for the school year. The result is ordered by total_hours descending and limited to the top clinicians, highlighting those who work the most hours.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate and efficient SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Top Clinicians by Hours\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start,\n         date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end\n)\nSELECT LOWER(ili.clinician) AS clinician,\n       SUM(ili.hours) AS total_hours\nFROM invoice_line_items ili\nJOIN invoices i ON ili.invoice_id = i.id\n, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end\nGROUP BY LOWER(ili.clinician)\nORDER BY total_hours DESC\nLIMIT 5;\n\n\n{&quot;sql&quot;: &quot;WITH sy AS (SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start, date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end) SELECT LOWER(ili.clinician) AS clinician, SUM(ili.hours) AS total_hours FROM invoice_line_items ili JOIN invoices i ON ili.invoice_id = i.id , sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end GROUP BY LOWER(ili.clinician) ORDER BY total_hours DESC LIMIT 5;&quot;}</p>"}
{"id": "0035", "question": "Which clinicians have the highest total cost this school year?", "text": "These questions focus on clinicians who generate the highest billed cost over the school year. We use the invoice_line_items table joined to invoices so we can access both cost and invoice dates. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter i.invoice_date into this window. We scope by i.district_key to ensure the analysis is district\u2011specific. We group by LOWER(ili.clinician) and compute SUM(ili.cost) as each clinician\u2019s total cost for the school year. The result is ordered by total_cost descending and limited to the top clinicians, highlighting those with the highest billings.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate and efficient SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Top Clinicians by Cost\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime('%Y','now')||'-07-01') AS start,\n         date(strftime('%Y','now')||'-06-30','+1 year') AS end\n)\nSELECT LOWER(ili.clinician) AS clinician,\n       SUM(ili.cost) AS total_cost\nFROM invoice_line_items ili\nJOIN invoices i ON ili.invoice_id = i.id\n, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end\nGROUP BY LOWER(ili.clinician)\nORDER BY total_cost DESC\nLIMIT 5;\n\n{\"sql\": \"WITH sy AS (SELECT date(strftime('%Y','now')||'-07-01') AS start, date(strftime('%Y','now')||'-06-30','+1 year') AS end) SELECT LOWER(ili.clinician) AS clinician, SUM(ili.cost) AS total_cost FROM invoice_line_items ili JOIN invoices i ON ili.invoice_id = i.id , sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end GROUP BY LOWER(ili.clinician) ORDER BY total_cost DESC LIMIT 5;\"}", "sql_used": null, "rows": null, "html": "<p>These questions focus on clinicians who generate the highest billed cost over the school year. We use the invoice_line_items table joined to invoices so we can access both cost and invoice dates. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter i.invoice_date into this window. We scope by i.district_key to ensure the analysis is district\u2011specific. We group by LOWER(ili.clinician) and compute SUM(ili.cost) as each clinician\u2019s total cost for the school year. The result is ordered by total_cost descending and limited to the top clinicians, highlighting those with the highest billings.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate and efficient SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Top Clinicians by Cost\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start,\n         date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end\n)\nSELECT LOWER(ili.clinician) AS clinician,\n       SUM(ili.cost) AS total_cost\nFROM invoice_line_items ili\nJOIN invoices i ON ili.invoice_id = i.id\n, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end\nGROUP BY LOWER(ili.clinician)\nORDER BY total_cost DESC\nLIMIT 5;\n\n{&quot;sql&quot;: &quot;WITH sy AS (SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start, date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end) SELECT LOWER(ili.clinician) AS clinician, SUM(ili.cost) AS total_cost FROM invoice_line_items ili JOIN invoices i ON ili.invoice_id = i.id , sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end GROUP BY LOWER(ili.clinician) ORDER BY total_cost DESC LIMIT 5;&quot;}</p>"}
{"id": "0036", "question": "Show hours by clinician type for this school year.", "text": "These questions ask for total hours by clinician type over the school year. We use the invoice_line_items table joined to invoices so we can combine line\u2011level hours with invoice dates. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter i.invoice_date into this window. We scope by i.district_key to ensure the analysis is district\u2011specific. We group by LOWER(ili.service_code) as the clinician type and compute SUM(ili.hours) for each type over the school year. The result compares total hours across clinician types.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate and efficient SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Hours by Clinician Type\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime('%Y','now')||'-07-01') AS start,\n         date(strftime('%Y','now')||'-06-30','+1 year') AS end\n)\nSELECT LOWER(ili.service_code) AS clinician_type,\n       SUM(ili.hours) AS total_hours\nFROM invoice_line_items ili\nJOIN invoices i ON ili.invoice_id = i.id\n, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end\nGROUP BY LOWER(ili.service_code)\nORDER BY total_hours DESC;\n\n{\"sql\": \"WITH sy AS (SELECT date(strftime('%Y','now')||'-07-01') AS start, date(strftime('%Y','now')||'-06-30','+1 year') AS end) SELECT LOWER(ili.service_code) AS clinician_type, SUM(ili.hours) AS total_hours FROM invoice_line_items ili JOIN invoices i ON ili.invoice_id = i.id , sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end GROUP BY LOWER(ili.service_code) ORDER BY total_hours DESC;\"}", "sql_used": null, "rows": null, "html": "<p>These questions ask for total hours by clinician type over the school year. We use the invoice_line_items table joined to invoices so we can combine line\u2011level hours with invoice dates. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter i.invoice_date into this window. We scope by i.district_key to ensure the analysis is district\u2011specific. We group by LOWER(ili.service_code) as the clinician type and compute SUM(ili.hours) for each type over the school year. The result compares total hours across clinician types.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate and efficient SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Hours by Clinician Type\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start,\n         date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end\n)\nSELECT LOWER(ili.service_code) AS clinician_type,\n       SUM(ili.hours) AS total_hours\nFROM invoice_line_items ili\nJOIN invoices i ON ili.invoice_id = i.id\n, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end\nGROUP BY LOWER(ili.service_code)\nORDER BY total_hours DESC;\n\n{&quot;sql&quot;: &quot;WITH sy AS (SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start, date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end) SELECT LOWER(ili.service_code) AS clinician_type, SUM(ili.hours) AS total_hours FROM invoice_line_items ili JOIN invoices i ON ili.invoice_id = i.id , sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end GROUP BY LOWER(ili.service_code) ORDER BY total_hours DESC;&quot;}</p>"}
{"id": "0037", "question": "Show cost by clinician type for this school year.", "text": "These questions ask for total cost by clinician type over the school year. We use the invoice_line_items table joined to invoices so we can combine line\u2011level cost with invoice dates. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter i.invoice_date into this window. We scope by i.district_key to ensure the analysis is district\u2011specific. We group by LOWER(ili.service_code) as the clinician type and compute SUM(ili.cost) for each type over the school year. The result compares total cost across clinician types.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate and efficient SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Cost by Clinician Type\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime('%Y','now')||'-07-01') AS start,\n         date(strftime('%Y','now')||'-06-30','+1 year') AS end\n)\nSELECT LOWER(ili.service_code) AS clinician_type,\n       SUM(ili.cost) AS total_cost\nFROM invoice_line_items ili\nJOIN invoices i ON ili.invoice_id = i.id\n, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end\nGROUP BY LOWER(ili.service_code)\nORDER BY total_cost DESC;\n\n{\"sql\": \"WITH sy AS (SELECT date(strftime('%Y','now')||'-07-01') AS start, date(strftime('%Y','now')||'-06-30','+1 year') AS end) SELECT LOWER(ili.service_code) AS clinician_type, SUM(ili.cost) AS total_cost FROM invoice_line_items ili JOIN invoices i ON ili.invoice_id = i.id , sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end GROUP BY LOWER(ili.service_code) ORDER BY total_cost DESC;\"}", "sql_used": null, "rows": null, "html": "<p>These questions ask for total cost by clinician type over the school year. We use the invoice_line_items table joined to invoices so we can combine line\u2011level cost with invoice dates. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter i.invoice_date into this window. We scope by i.district_key to ensure the analysis is district\u2011specific. We group by LOWER(ili.service_code) as the clinician type and compute SUM(ili.cost) for each type over the school year. The result compares total cost across clinician types.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate and efficient SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Cost by Clinician Type\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start,\n         date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end\n)\nSELECT LOWER(ili.service_code) AS clinician_type,\n       SUM(ili.cost) AS total_cost\nFROM invoice_line_items ili\nJOIN invoices i ON ili.invoice_id = i.id\n, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end\nGROUP BY LOWER(ili.service_code)\nORDER BY total_cost DESC;\n\n{&quot;sql&quot;: &quot;WITH sy AS (SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start, date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end) SELECT LOWER(ili.service_code) AS clinician_type, SUM(ili.cost) AS total_cost FROM invoice_line_items ili JOIN invoices i ON ili.invoice_id = i.id , sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end GROUP BY LOWER(ili.service_code) ORDER BY total_cost DESC;&quot;}</p>"}
{"id": "0038", "question": "Compare clinician types by monthly hours.", "text": "These questions ask for monthly hours broken out by clinician type. We use the invoice_line_items table joined to invoices so we can combine line\u2011level hours with invoice dates. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter i.invoice_date into this window. We scope by i.district_key to ensure the analysis is district\u2011specific. We group by LOWER(ili.service_code) and the year-month value derived from i.invoice_date. We compute SUM(ili.hours) for each type and month combination. The result is a grid of monthly hour totals by clinician type that can be used for comparisons and trend analysis.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate and efficient SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Monthly Hours by Clinician Type\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime('%Y','now')||'-07-01') AS start,\n         date(strftime('%Y','now')||'-06-30','+1 year') AS end\n),\ndata AS (\n  SELECT LOWER(ili.service_code) AS clinician_type,\n         strftime('%Y-%m', i.invoice_date) AS year_month,\n         ili.hours\n  FROM invoice_line_items ili\n  JOIN invoices i ON ili.invoice_id = i.id\n  , sy\n  WHERE i.district_key = :district_key\n    AND date(i.invoice_date) BETWEEN sy.start AND sy.end\n)\nSELECT clinician_type,\n       year_month,\n       SUM(hours) AS total_hours\nFROM data\nGROUP BY clinician_type, year_month\nORDER BY clinician_type, year_month;\n\n{\"sql\": \"WITH sy AS (SELECT date(strftime('%Y','now')||'-07-01') AS start, date(strftime('%Y','now')||'-06-30','+1 year') AS end), data AS (SELECT LOWER(ili.service_code) AS clinician_type, strftime('%Y-%m', i.invoice_date) AS year_month, ili.hours FROM invoice_line_items ili JOIN invoices i ON ili.invoice_id = i.id , sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end) SELECT clinician_type, year_month, SUM(hours) AS total_hours FROM data GROUP BY clinician_type, year_month ORDER BY clinician_type, year_month;\"}", "sql_used": null, "rows": null, "html": "<p>These questions ask for monthly hours broken out by clinician type. We use the invoice_line_items table joined to invoices so we can combine line\u2011level hours with invoice dates. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter i.invoice_date into this window. We scope by i.district_key to ensure the analysis is district\u2011specific. We group by LOWER(ili.service_code) and the year-month value derived from i.invoice_date. We compute SUM(ili.hours) for each type and month combination. The result is a grid of monthly hour totals by clinician type that can be used for comparisons and trend analysis.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate and efficient SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Monthly Hours by Clinician Type\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start,\n         date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end\n),\ndata AS (\n  SELECT LOWER(ili.service_code) AS clinician_type,\n         strftime(&#x27;%Y-%m&#x27;, i.invoice_date) AS year_month,\n         ili.hours\n  FROM invoice_line_items ili\n  JOIN invoices i ON ili.invoice_id = i.id\n  , sy\n  WHERE i.district_key = :district_key\n    AND date(i.invoice_date) BETWEEN sy.start AND sy.end\n)\nSELECT clinician_type,\n       year_month,\n       SUM(hours) AS total_hours\nFROM data\nGROUP BY clinician_type, year_month\nORDER BY clinician_type, year_month;\n\n{&quot;sql&quot;: &quot;WITH sy AS (SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start, date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end), data AS (SELECT LOWER(ili.service_code) AS clinician_type, strftime(&#x27;%Y-%m&#x27;, i.invoice_date) AS year_month, ili.hours FROM invoice_line_items ili JOIN invoices i ON ili.invoice_id = i.id , sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end) SELECT clinician_type, year_month, SUM(hours) AS total_hours FROM data GROUP BY clinician_type, year_month ORDER BY clinician_type, year_month;&quot;}</p>"}
{"id": "0039", "question": "Compare clinician types by monthly cost.", "text": "These questions ask for monthly cost broken out by clinician type. We use the invoice_line_items table joined to invoices so we can combine line\u2011level cost with invoice dates. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter i.invoice_date into this window. We scope by i.district_key to ensure the analysis is district\u2011specific. We group by LOWER(ili.service_code) and the year-month value from i.invoice_date. We compute SUM(ili.cost) for each type and month combination. The result is a grid of monthly cost totals by clinician type that can be used for comparisons and trend analysis.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate and efficient SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Monthly Cost by Clinician Type\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime('%Y','now')||'-07-01') AS start,\n         date(strftime('%Y','now')||'-06-30','+1 year') AS end\n),\ndata AS (\n  SELECT LOWER(ili.service_code) AS clinician_type,\n         strftime('%Y-%m', i.invoice_date) AS year_month,\n         ili.cost\n  FROM invoice_line_items ili\n  JOIN invoices i ON ili.invoice_id = i.id\n  , sy\n  WHERE i.district_key = :district_key\n    AND date(i.invoice_date) BETWEEN sy.start AND sy.end\n)\nSELECT clinician_type,\n       year_month,\n       SUM(cost) AS total_cost\nFROM data\nGROUP BY clinician_type, year_month\nORDER BY clinician_type, year_month;\n\n{\"sql\": \"WITH sy AS (SELECT date(strftime('%Y','now')||'-07-01') AS start, date(strftime('%Y','now')||'-06-30','+1 year') AS end), data AS (SELECT LOWER(ili.service_code) AS clinician_type, strftime('%Y-%m', i.invoice_date) AS year_month, ili.cost FROM invoice_line_items ili JOIN invoices i ON ili.invoice_id = i.id , sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end) SELECT clinician_type, year_month, SUM(cost) AS total_cost FROM data GROUP BY clinician_type, year_month ORDER BY clinician_type, year_month;\"}", "sql_used": null, "rows": null, "html": "<p>These questions ask for monthly cost broken out by clinician type. We use the invoice_line_items table joined to invoices so we can combine line\u2011level cost with invoice dates. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter i.invoice_date into this window. We scope by i.district_key to ensure the analysis is district\u2011specific. We group by LOWER(ili.service_code) and the year-month value from i.invoice_date. We compute SUM(ili.cost) for each type and month combination. The result is a grid of monthly cost totals by clinician type that can be used for comparisons and trend analysis.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate and efficient SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Monthly Cost by Clinician Type\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start,\n         date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end\n),\ndata AS (\n  SELECT LOWER(ili.service_code) AS clinician_type,\n         strftime(&#x27;%Y-%m&#x27;, i.invoice_date) AS year_month,\n         ili.cost\n  FROM invoice_line_items ili\n  JOIN invoices i ON ili.invoice_id = i.id\n  , sy\n  WHERE i.district_key = :district_key\n    AND date(i.invoice_date) BETWEEN sy.start AND sy.end\n)\nSELECT clinician_type,\n       year_month,\n       SUM(cost) AS total_cost\nFROM data\nGROUP BY clinician_type, year_month\nORDER BY clinician_type, year_month;\n\n{&quot;sql&quot;: &quot;WITH sy AS (SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start, date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end), data AS (SELECT LOWER(ili.service_code) AS clinician_type, strftime(&#x27;%Y-%m&#x27;, i.invoice_date) AS year_month, ili.cost FROM invoice_line_items ili JOIN invoices i ON ili.invoice_id = i.id , sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end) SELECT clinician_type, year_month, SUM(cost) AS total_cost FROM data GROUP BY clinician_type, year_month ORDER BY clinician_type, year_month;&quot;}</p>"}
{"id": "0040", "question": "Compare Amelia Sanders and Aubrey Garcia by monthly hours.", "text": "Here is the monthly hours comparison for Amelia Sanders and Aubrey Garcia.", "sql_used": null, "rows": null, "html": "<p>Here is the monthly hours comparison for Amelia Sanders and Aubrey Garcia.</p>"}
{"id": "0041", "question": "Compare Amelia Sanders and Aubrey Garcia by monthly cost.", "text": "Here is the monthly cost comparison for Amelia Sanders and Aubrey Garcia.", "sql_used": null, "rows": null, "html": "<p>Here is the monthly cost comparison for Amelia Sanders and Aubrey Garcia.</p>"}
{"id": "0042", "question": "Show clinicians with increasing hours over the last three months.", "text": "These questions ask for clinicians whose hours have been rising over successive months. We work from the invoice_line_items table joined to invoices so we can access both hours and invoice dates. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter i.invoice_date into this window. We scope by i.district_key to ensure the analysis is district\u2011specific. We compute monthly totals per clinician using LCASE(ili.clinician) and a year\u2011month value from i.invoice_date, grouping accordingly. A window function (such as LAG) partitioned by clinician_name looks back at the previous month\u2019s hours. In the final query, we filter for rows where total_hours &gt; prev_month and prev_month is not null, optionally ordering by total_hours descending. This reveals clinicians whose monthly hours are increasing.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate and efficient SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service was delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Clinicians with Increasing Hours\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime('%Y','now')||'-07-01') AS start,\n         date(strftime('%Y','now')||'-06-30','+1 year') AS end\n),\nmonthly_totals AS (\n  SELECT LCASE(ili.clinician) AS clinician_name,\n         strftime('%Y-%m', i.invoice_date) AS year_month,\n         SUM(ili.hours) AS total_hours\n  FROM invoice_line_items ili\n  JOIN invoices i ON ili.invoice_id = i.id\n  WHERE i.district_key = :district_key\n    AND date(i.invoice_date) BETWEEN sy.start AND sy.end\n  GROUP BY clinician_name, year_month\n),\nranked AS (\n  SELECT clinician_name,\n         year_month,\n         total_hours,\n         LAG(total_hours) OVER (PARTITION BY clinician_name ORDER BY year_month) AS prev_month\n  FROM monthly_totals\n)\nSELECT clinician_name, year_month, total_hours, prev_month\nFROM ranked\nWHERE prev_month IS NOT NULL\n  AND total_hours > prev_month\nORDER BY total_hours DESC;\n\n{\"sql\": \"WITH sy AS (SELECT date(strftime('%Y','now')||'-07-01') AS start, date(strftime('%Y','now')||'-06-30','+1 year') AS end), monthly_totals AS (SELECT LCASE(ili.clinician) AS clinician_name, strftime('%Y-%m', i.invoice_date) AS year_month, SUM(ili.hours) AS total_hours FROM invoice_line_items ili JOIN invoices i ON ili.invoice_id = i.id WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end GROUP BY clinician_name, year_month), ranked AS (SELECT clinician_name, year_month, total_hours, LAG(total_hours) OVER (PARTITION BY clinician_name ORDER BY year_month) AS prev_month FROM monthly_totals) SELECT clinician_name, year_month, total_hours, prev_month FROM ranked WHERE prev_month IS NOT NULL AND total_hours > prev_month ORDER BY total_hours DESC;\"}", "sql_used": null, "rows": null, "html": "<p>These questions ask for clinicians whose hours have been rising over successive months. We work from the invoice_line_items table joined to invoices so we can access both hours and invoice dates. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter i.invoice_date into this window. We scope by i.district_key to ensure the analysis is district\u2011specific. We compute monthly totals per clinician using LCASE(ili.clinician) and a year\u2011month value from i.invoice_date, grouping accordingly. A window function (such as LAG) partitioned by clinician_name looks back at the previous month\u2019s hours. In the final query, we filter for rows where total_hours &amp;gt; prev_month and prev_month is not null, optionally ordering by total_hours descending. This reveals clinicians whose monthly hours are increasing.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate and efficient SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service was delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Clinicians with Increasing Hours\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start,\n         date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end\n),\nmonthly_totals AS (\n  SELECT LCASE(ili.clinician) AS clinician_name,\n         strftime(&#x27;%Y-%m&#x27;, i.invoice_date) AS year_month,\n         SUM(ili.hours) AS total_hours\n  FROM invoice_line_items ili\n  JOIN invoices i ON ili.invoice_id = i.id\n  WHERE i.district_key = :district_key\n    AND date(i.invoice_date) BETWEEN sy.start AND sy.end\n  GROUP BY clinician_name, year_month\n),\nranked AS (\n  SELECT clinician_name,\n         year_month,\n         total_hours,\n         LAG(total_hours) OVER (PARTITION BY clinician_name ORDER BY year_month) AS prev_month\n  FROM monthly_totals\n)\nSELECT clinician_name, year_month, total_hours, prev_month\nFROM ranked\nWHERE prev_month IS NOT NULL\n  AND total_hours &gt; prev_month\nORDER BY total_hours DESC;\n\n{&quot;sql&quot;: &quot;WITH sy AS (SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start, date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end), monthly_totals AS (SELECT LCASE(ili.clinician) AS clinician_name, strftime(&#x27;%Y-%m&#x27;, i.invoice_date) AS year_month, SUM(ili.hours) AS total_hours FROM invoice_line_items ili JOIN invoices i ON ili.invoice_id = i.id WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end GROUP BY clinician_name, year_month), ranked AS (SELECT clinician_name, year_month, total_hours, LAG(total_hours) OVER (PARTITION BY clinician_name ORDER BY year_month) AS prev_month FROM monthly_totals) SELECT clinician_name, year_month, total_hours, prev_month FROM ranked WHERE prev_month IS NOT NULL AND total_hours &gt; prev_month ORDER BY total_hours DESC;&quot;}</p>"}
{"id": "0043", "question": "Show clinicians with decreasing hours over the last three months.", "text": "These questions ask for clinicians whose hours have been falling over successive months. We work from the invoice_line_items table joined to invoices so we can access both hours and invoice dates. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter i.invoice_date into this window. We scope by i.district_key to ensure the analysis is district\u2011specific. We compute monthly totals per clinician using LCASE(ili.clinician) and a year\u2011month value from i.invoice_date, grouping accordingly. A window function (such as LAG) partitioned by clinician_name looks back at the previous month. In the final query, we filter for rows where total_hours &lt; prev_month and prev_month is not null, optionally ordering by total_hours ascending. This reveals clinicians whose monthly hours are decreasing.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate and efficient SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Clinicians with Decreasing Hours\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime('%Y','now')||'-07-01') AS start,\n         date(strftime('%Y','now')||'-06-30','+1 year') AS end\n),\nmonthly_totals AS (\n  SELECT LCASE(ili.clinician) AS clinician_name,\n         strftime('%Y-%m', i.invoice_date) AS year_month,\n         SUM(ili.hours) AS total_hours\n  FROM invoice_line_items ili\n  JOIN invoices i ON ili.invoice_id = i.id\n  WHERE i.district_key = :district_key\n    AND date(i.invoice_date) BETWEEN sy.start AND sy.end\n  GROUP BY clinician_name, year_month\n),\nranked AS (\n  SELECT clinician_name,\n         year_month,\n         total_hours,\n         LAG(total_hours) OVER (PARTITION BY clinician_name ORDER BY year_month) AS prev_month\n  FROM monthly_totals\n)\nSELECT clinician_name, year_month, total_hours, prev_month\nFROM ranked\nWHERE prev_month IS NOT NULL\n  AND total_hours < prev_month\nORDER BY total_hours ASC;\n\n{\"sql\": \"WITH sy AS (SELECT date(strftime('%Y','now')||'-07-01') AS start, date(strftime('%Y','now')||'-06-30','+1 year') AS end), monthly_totals AS (SELECT LCASE(ili.clinician) AS clinician_name, strftime('%Y-%m', i.invoice_date) AS year_month, SUM(ili.hours) AS total_hours FROM invoice_line_items ili JOIN invoices i ON ili.invoice_id = i.id WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end GROUP BY clinician_name, year_month), ranked AS (SELECT clinician_name, year_month, total_hours, LAG(total_hours) OVER (PARTITION BY clinician_name ORDER BY year_month) AS prev_month FROM monthly_totals) SELECT clinician_name, year_month, total_hours, prev_month FROM ranked WHERE prev_month IS NOT NULL AND total_hours < prev_month ORDER BY total_hours ASC;\"}", "sql_used": null, "rows": null, "html": "<p>These questions ask for clinicians whose hours have been falling over successive months. We work from the invoice_line_items table joined to invoices so we can access both hours and invoice dates. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter i.invoice_date into this window. We scope by i.district_key to ensure the analysis is district\u2011specific. We compute monthly totals per clinician using LCASE(ili.clinician) and a year\u2011month value from i.invoice_date, grouping accordingly. A window function (such as LAG) partitioned by clinician_name looks back at the previous month. In the final query, we filter for rows where total_hours &amp;lt; prev_month and prev_month is not null, optionally ordering by total_hours ascending. This reveals clinicians whose monthly hours are decreasing.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate and efficient SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Clinicians with Decreasing Hours\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start,\n         date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end\n),\nmonthly_totals AS (\n  SELECT LCASE(ili.clinician) AS clinician_name,\n         strftime(&#x27;%Y-%m&#x27;, i.invoice_date) AS year_month,\n         SUM(ili.hours) AS total_hours\n  FROM invoice_line_items ili\n  JOIN invoices i ON ili.invoice_id = i.id\n  WHERE i.district_key = :district_key\n    AND date(i.invoice_date) BETWEEN sy.start AND sy.end\n  GROUP BY clinician_name, year_month\n),\nranked AS (\n  SELECT clinician_name,\n         year_month,\n         total_hours,\n         LAG(total_hours) OVER (PARTITION BY clinician_name ORDER BY year_month) AS prev_month\n  FROM monthly_totals\n)\nSELECT clinician_name, year_month, total_hours, prev_month\nFROM ranked\nWHERE prev_month IS NOT NULL\n  AND total_hours &lt; prev_month\nORDER BY total_hours ASC;\n\n{&quot;sql&quot;: &quot;WITH sy AS (SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start, date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end), monthly_totals AS (SELECT LCASE(ili.clinician) AS clinician_name, strftime(&#x27;%Y-%m&#x27;, i.invoice_date) AS year_month, SUM(ili.hours) AS total_hours FROM invoice_line_items ili JOIN invoices i ON ili.invoice_id = i.id WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end GROUP BY clinician_name, year_month), ranked AS (SELECT clinician_name, year_month, total_hours, LAG(total_hours) OVER (PARTITION BY clinician_name ORDER BY year_month) AS prev_month FROM monthly_totals) SELECT clinician_name, year_month, total_hours, prev_month FROM ranked WHERE prev_month IS NOT NULL AND total_hours &lt; prev_month ORDER BY total_hours ASC;&quot;}</p>"}
{"id": "0044", "question": "Show all services delivered by Amelia Sanders over a date range.", "text": "No invoices found for Amelia Sanders.", "sql_used": "SELECT invoice_number, student_name, total_cost, service_month, status FROM invoices WHERE invoices.district_key = :district_key AND LOWER(invoices.student_name) LIKE LOWER('%Amelia Sanders%') ORDER BY invoice_date DESC, total_cost DESC", "rows": [], "html": "<p>No invoices found for Amelia Sanders.</p>"}
{"id": "0045", "question": "Show total district spend by month for this school year.", "text": "These questions ask for monthly districtwide spending over the current school year. We use the invoices table where total_cost per student per vendor per month is available. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter invoice_date into this window. We scope by district_key to ensure all invoices belong to the correct district. We group by LOWER(service_month) and compute SUM(total_cost) for each month. The final result is a month\u2011by\u2011month summary of total district spending that can be used for trend analysis.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: District Monthly Spend\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime('%Y','now')||'-07-01') AS start,\n         date(strftime('%Y','now')||'-06-30','+1 year') AS end\n)\nSELECT LOWER(service_month) AS service_month,\n       SUM(total_cost) AS total_cost\nFROM invoices i, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end\nGROUP BY LOWER(service_month);\n\n{\"sql\": \"WITH sy AS (SELECT date(strftime('%Y','now')||'-07-01') AS start, date(strftime('%Y','now')||'-06-30','+1 year') AS end) SELECT LOWER(service_month) AS service_month, SUM(total_cost) AS total_cost FROM invoices i, sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end GROUP BY LOWER(service_month);\"}", "sql_used": null, "rows": null, "html": "<p>These questions ask for monthly districtwide spending over the current school year. We use the invoices table where total_cost per student per vendor per month is available. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter invoice_date into this window. We scope by district_key to ensure all invoices belong to the correct district. We group by LOWER(service_month) and compute SUM(total_cost) for each month. The final result is a month\u2011by\u2011month summary of total district spending that can be used for trend analysis.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: District Monthly Spend\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start,\n         date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end\n)\nSELECT LOWER(service_month) AS service_month,\n       SUM(total_cost) AS total_cost\nFROM invoices i, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end\nGROUP BY LOWER(service_month);\n\n{&quot;sql&quot;: &quot;WITH sy AS (SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start, date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end) SELECT LOWER(service_month) AS service_month, SUM(total_cost) AS total_cost FROM invoices i, sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end GROUP BY LOWER(service_month);&quot;}</p>"}
{"id": "0046", "question": "Show total district hours by month for this school year.", "text": "These questions ask for monthly districtwide hours over the current school year. We use the invoices table where total_hours per student per vendor per month is available. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter invoice_date into this window. We scope by district_key to ensure all invoices belong to the correct district. We group by LOWER(service_month) and compute SUM(total_hours) for each month. The final result is a month\u2011by\u2011month summary of total district hours that can be used for trend analysis.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: District Monthly Hours\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime('%Y','now')||'-07-01') AS start,\n         date(strftime('%Y','now')||'-06-30','+1 year') AS end\n)\nSELECT LOWER(service_month) AS service_month,\n       SUM(total_hours) AS total_hours\nFROM invoices i, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end\nGROUP BY LOWER(service_month);\n\n{\"sql\": \"WITH sy AS (SELECT date(strftime('%Y','now')||'-07-01') AS start, date(strftime('%Y','now')||'-06-30','+1 year') AS end) SELECT LOWER(service_month) AS service_month, SUM(total_hours) AS total_hours FROM invoices i, sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end GROUP BY LOWER(service_month);\"}", "sql_used": null, "rows": null, "html": "<p>These questions ask for monthly districtwide hours over the current school year. We use the invoices table where total_hours per student per vendor per month is available. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter invoice_date into this window. We scope by district_key to ensure all invoices belong to the correct district. We group by LOWER(service_month) and compute SUM(total_hours) for each month. The final result is a month\u2011by\u2011month summary of total district hours that can be used for trend analysis.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: District Monthly Hours\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start,\n         date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end\n)\nSELECT LOWER(service_month) AS service_month,\n       SUM(total_hours) AS total_hours\nFROM invoices i, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end\nGROUP BY LOWER(service_month);\n\n{&quot;sql&quot;: &quot;WITH sy AS (SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start, date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end) SELECT LOWER(service_month) AS service_month, SUM(total_hours) AS total_hours FROM invoices i, sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end GROUP BY LOWER(service_month);&quot;}</p>"}
{"id": "0047", "question": "Show year-to-date district spend.", "text": "These questions ask for a single number: total district spending so far this year. We use the invoices table, scope by district_key, and compute SUM(total_cost) across all matching rows. A year\u2011to\u2011date CTE defines the start of the year as January 1 and the end as December 31, and we filter invoice_date between ytd.start and ytd.end. The result is a single scalar showing YTD spend for the district.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Year-to-Date Spend\n# ============================\n\nWITH ytd AS (\n  SELECT date(strftime('%Y','now')||'-01-01') AS start,\n         date(strftime('%Y','now')||'-12-31') AS end\n)\nSELECT SUM(total_cost) AS total_spend\nFROM invoices i, ytd\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN ytd.start AND ytd.end;\n\n{\"sql\": \"WITH ytd AS (SELECT date(strftime('%Y','now')||'-01-01') AS start, date(strftime('%Y','now')||'-12-31') AS end) SELECT SUM(total_cost) AS total_spend FROM invoices i, ytd WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN ytd.start AND ytd.end;\"}", "sql_used": null, "rows": null, "html": "<p>These questions ask for a single number: total district spending so far this year. We use the invoices table, scope by district_key, and compute SUM(total_cost) across all matching rows. A year\u2011to\u2011date CTE defines the start of the year as January 1 and the end as December 31, and we filter invoice_date between ytd.start and ytd.end. The result is a single scalar showing YTD spend for the district.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Year-to-Date Spend\n# ============================\n\nWITH ytd AS (\n  SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-01-01&#x27;) AS start,\n         date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-12-31&#x27;) AS end\n)\nSELECT SUM(total_cost) AS total_spend\nFROM invoices i, ytd\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN ytd.start AND ytd.end;\n\n{&quot;sql&quot;: &quot;WITH ytd AS (SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-01-01&#x27;) AS start, date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-12-31&#x27;) AS end) SELECT SUM(total_cost) AS total_spend FROM invoices i, ytd WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN ytd.start AND ytd.end;&quot;}</p>"}
{"id": "0048", "question": "Show year-to-date district hours.", "text": "These questions ask for a single number: total district hours so far this year. We use the invoices table, scope by district_key, and compute SUM(total_hours) across all matching rows. A year\u2011to\u2011date CTE defines the start of the year as January 1 and the end as December 31, and we filter invoice_date between ytd.start and ytd.end. The result is a single scalar showing YTD hours for the district.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Year-to-Date Hours\n# ============================\n\nWITH ytd AS (\n  SELECT date(strftime('%Y','now')||'-01-01') AS start,\n         date(strftime('%Y','now')||'-12-31') AS end\n)\nSELECT SUM(total_hours) AS total_hours\nFROM invoices i, ytd\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN ytd.start AND ytd.end;\n\n{\"sql\": \"WITH ytd AS (SELECT date(strftime('%Y','now')||'-01-01') AS start, date(strftime('%Y','now')||'-12-31') AS end) SELECT SUM(total_hours) AS total_hours FROM invoices i, ytd WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN ytd.start AND ytd.end;\"}", "sql_used": null, "rows": null, "html": "<p>These questions ask for a single number: total district hours so far this year. We use the invoices table, scope by district_key, and compute SUM(total_hours) across all matching rows. A year\u2011to\u2011date CTE defines the start of the year as January 1 and the end as December 31, and we filter invoice_date between ytd.start and ytd.end. The result is a single scalar showing YTD hours for the district.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Year-to-Date Hours\n# ============================\n\nWITH ytd AS (\n  SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-01-01&#x27;) AS start,\n         date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-12-31&#x27;) AS end\n)\nSELECT SUM(total_hours) AS total_hours\nFROM invoices i, ytd\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN ytd.start AND ytd.end;\n\n{&quot;sql&quot;: &quot;WITH ytd AS (SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-01-01&#x27;) AS start, date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-12-31&#x27;) AS end) SELECT SUM(total_hours) AS total_hours FROM invoices i, ytd WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN ytd.start AND ytd.end;&quot;}</p>"}
{"id": "0049", "question": "Show district spend trend over the school year.", "text": "These questions ask for a month\u2011by\u2011month district spending trend over the current school year. We use the invoices table where total_cost per student per vendor per month is available. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter invoice_date into this window. We scope by district_key to ensure all invoices belong to the correct district. We group by LOWER(service_month) and compute SUM(total_cost) for each month. The final result is a monthly spending timeline that can be used to understand how district costs change over the school year.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the services (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: School-Year Spend Trend\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime('%Y','now')||'-07-01') AS start,\n         date(strftime('%Y','now')||'-06-30','+1 year') AS end\n)\nSELECT LOWER(service_month) AS service_month,\n       SUM(total_cost) AS total_cost\nFROM invoices i, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end\nGROUP BY LOWER(service_month);\n\n{\"sql\": \"WITH sy AS (SELECT date(strftime('%Y','now')||'-07-01') AS start, date(strftime('%Y','now')||'-06-30','+1 year') AS end) SELECT LOWER(service_month) AS service_month, SUM(total_cost) AS total_cost FROM invoices i, sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end GROUP BY LOWER(service_month);\"}", "sql_used": null, "rows": null, "html": "<p>These questions ask for a month\u2011by\u2011month district spending trend over the current school year. We use the invoices table where total_cost per student per vendor per month is available. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter invoice_date into this window. We scope by district_key to ensure all invoices belong to the correct district. We group by LOWER(service_month) and compute SUM(total_cost) for each month. The final result is a monthly spending timeline that can be used to understand how district costs change over the school year.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the services (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: School-Year Spend Trend\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start,\n         date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end\n)\nSELECT LOWER(service_month) AS service_month,\n       SUM(total_cost) AS total_cost\nFROM invoices i, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end\nGROUP BY LOWER(service_month);\n\n{&quot;sql&quot;: &quot;WITH sy AS (SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start, date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end) SELECT LOWER(service_month) AS service_month, SUM(total_cost) AS total_cost FROM invoices i, sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end GROUP BY LOWER(service_month);&quot;}</p>"}
{"id": "0050", "question": "Show district hours trend over the school year.", "text": "These questions ask for a month\u2011by\u2011month district hours trend over the current school year. We use the invoices table where total_hours per student per vendor per month is available. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter invoice_date into this window. We scope by district_key to ensure all invoices belong to the correct district. We group by LOWER(service_month) and compute SUM(total_hours) for each month. The final result is a monthly hours timeline that can be used to understand how district service hours change over the school year.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: School-Year Hours Trend\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime('%Y','now')||'-07-01') AS start,\n         date(strftime('%Y','now')||'-06-30','+1 year') AS end\n)\nSELECT LOWER(service_month) AS service_month,\n       SUM(total_hours) AS total_hours\nFROM invoices i, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end\nGROUP BY LOWER(service_month);\n\n{\"sql\": \"WITH sy AS (SELECT date(strftime('%Y','now')||'-07-01') AS start, date(strftime('%Y','now')||'-06-30','+1 year') AS end) SELECT LOWER(service_month) AS service_month, SUM(total_hours) AS total_hours FROM invoices i, sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end GROUP BY LOWER(service_month);\"}", "sql_used": null, "rows": null, "html": "<p>These questions ask for a month\u2011by\u2011month district hours trend over the current school year. We use the invoices table where total_hours per student per vendor per month is available. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter invoice_date into this window. We scope by district_key to ensure all invoices belong to the correct district. We group by LOWER(service_month) and compute SUM(total_hours) for each month. The final result is a monthly hours timeline that can be used to understand how district service hours change over the school year.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: School-Year Hours Trend\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start,\n         date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end\n)\nSELECT LOWER(service_month) AS service_month,\n       SUM(total_hours) AS total_hours\nFROM invoices i, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end\nGROUP BY LOWER(service_month);\n\n{&quot;sql&quot;: &quot;WITH sy AS (SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start, date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end) SELECT LOWER(service_month) AS service_month, SUM(total_hours) AS total_hours FROM invoices i, sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end GROUP BY LOWER(service_month);&quot;}</p>"}
{"id": "0051", "question": "Which month had the highest district spend this school year?", "text": "These questions look for the single month with the highest total district spend within the current school year. We use the invoices table, scope by district_key, and compute monthly totals in a subquery or CTE similar to the school\u2011year trend queries. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter invoice_date into this window. Once we have monthly totals, we order by total_cost descending and limit to one row. The resulting month and amount represent the highest\u2011spending month for the district in the current school year.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Highest Monthly Spend\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime('%Y','now')||'-07-01') AS start,\n         date(strftime('%Y','now')||'-06-30','+1 year') AS end\n),\nmonthly_totals AS (\n  SELECT LOWER(service_month) AS service_month,\n         SUM(total_cost) AS total_cost\n  FROM invoices i, sy\n  WHERE i.district_key = :district_key\n    AND date(i.invoice_date) BETWEEN sy.start AND sy.end\n  GROUP BY LOWER(service_month)\n)\nSELECT service_month, total_cost\nFROM monthly_totals\nORDER BY total_cost DESC\nLIMIT 1;\n\n{\"sql\": \"WITH sy AS (SELECT date(strftime('%Y','now')||'-07-01') AS start, date(strftime('%Y','now')||'-06-30','+1 year') AS end), monthly_totals AS (SELECT LOWER(service_month) AS service_month, SUM(total_cost) AS total_cost FROM invoices i, sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end GROUP BY LOWER(service_month)) SELECT service_month, total_cost FROM monthly_totals ORDER BY total_cost DESC LIMIT 1;\"}", "sql_used": null, "rows": null, "html": "<p>These questions look for the single month with the highest total district spend within the current school year. We use the invoices table, scope by district_key, and compute monthly totals in a subquery or CTE similar to the school\u2011year trend queries. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter invoice_date into this window. Once we have monthly totals, we order by total_cost descending and limit to one row. The resulting month and amount represent the highest\u2011spending month for the district in the current school year.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Highest Monthly Spend\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start,\n         date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end\n),\nmonthly_totals AS (\n  SELECT LOWER(service_month) AS service_month,\n         SUM(total_cost) AS total_cost\n  FROM invoices i, sy\n  WHERE i.district_key = :district_key\n    AND date(i.invoice_date) BETWEEN sy.start AND sy.end\n  GROUP BY LOWER(service_month)\n)\nSELECT service_month, total_cost\nFROM monthly_totals\nORDER BY total_cost DESC\nLIMIT 1;\n\n{&quot;sql&quot;: &quot;WITH sy AS (SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start, date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end), monthly_totals AS (SELECT LOWER(service_month) AS service_month, SUM(total_cost) AS total_cost FROM invoices i, sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end GROUP BY LOWER(service_month)) SELECT service_month, total_cost FROM monthly_totals ORDER BY total_cost DESC LIMIT 1;&quot;}</p>"}
{"id": "0052", "question": "Which month had the lowest district spend this school year?", "text": "These questions look for the single month with the lowest total district spend within the current school year. We use the invoices table, scope by district_key, and compute monthly totals in a subquery or CTE similar to the school\u2011year trend queries. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter invoice_date into this window. Once we have monthly totals, we order by total_cost ascending and limit to one row. The resulting month and amount represent the lowest\u2011spending month for the district in the current school year.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **total_hours** (REAL)  \n  Sum of hours for that entry.\n\n- **total_cost** (REAL)  \n  Cost for that entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Lowest Monthly Spend\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime('%Y','now')||'-07-01') AS start,\n         date(strftime('%Y','now')||'-06-30','+1 year') AS end\n),\nmonthly_totals AS (\n  SELECT LOWER(service_month) AS service_month,\n         SUM(total_cost) AS total_cost\n  FROM invoices i, sy\n  WHERE i.district_key = :district_key\n    AND date(i.invoice_date) BETWEEN sy.start AND sy.end\n  GROUP BY LOWER(service_month)\n)\nSELECT service_month, total_cost\nFROM monthly_totals\nORDER BY total_cost ASC\nLIMIT 1;\n\n{\"sql\": \"WITH sy AS (SELECT date(strftime('%Y','now')||'-07-01') AS start, date(strftime('%Y','now')||'-06-30','+1 year') AS end), monthly_totals AS (SELECT LOWER(service_month) AS service_month, SUM(total_cost) AS total_cost FROM invoices i, sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end GROUP BY LOWER(service_month)) SELECT service_month, total_cost FROM monthly_totals ORDER BY total_cost ASC LIMIT 1;\"}", "sql_used": null, "rows": null, "html": "<p>These questions look for the single month with the lowest total district spend within the current school year. We use the invoices table, scope by district_key, and compute monthly totals in a subquery or CTE similar to the school\u2011year trend queries. A school\u2011year CTE defines sy.start as July 1 and sy.end as June 30 of the following year, and we filter invoice_date into this window. Once we have monthly totals, we order by total_cost ascending and limit to one row. The resulting month and amount represent the lowest\u2011spending month for the district in the current school year.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **total_hours** (REAL)  \n  Sum of hours for that entry.\n\n- **total_cost** (REAL)  \n  Cost for that entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Lowest Monthly Spend\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start,\n         date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end\n),\nmonthly_totals AS (\n  SELECT LOWER(service_month) AS service_month,\n         SUM(total_cost) AS total_cost\n  FROM invoices i, sy\n  WHERE i.district_key = :district_key\n    AND date(i.invoice_date) BETWEEN sy.start AND sy.end\n  GROUP BY LOWER(service_month)\n)\nSELECT service_month, total_cost\nFROM monthly_totals\nORDER BY total_cost ASC\nLIMIT 1;\n\n{&quot;sql&quot;: &quot;WITH sy AS (SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start, date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end), monthly_totals AS (SELECT LOWER(service_month) AS service_month, SUM(total_cost) AS total_cost FROM invoices i, sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end GROUP BY LOWER(service_month)) SELECT service_month, total_cost FROM monthly_totals ORDER BY total_cost ASC LIMIT 1;&quot;}</p>"}
{"id": "0053", "question": "What is the district's average monthly spend this school year?", "text": "These questions ask for an average monthly spend across the school year. We use the invoices table scoped by district_key and define a school\u2011year CTE with sy.start as July 1 and sy.end as June 30 of the following year. We filter invoice_date between sy.start and sy.end. Instead of grouping by month, we compute SUM(total_cost) over all invoices in this window. We then divide this sum by 12 (the number of months in a school year), often with rounding for readability. The result is a single scalar representing the average monthly district spend for the current school year.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Average Monthly Spend\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime('%Y','now')||'-07-01') AS start,\n         date(strftime('%Y','now')||'-06-30','+1 year') AS end\n)\nSELECT ROUND(SUM(total_cost) / 12, 2) AS average_monthly_spend\nFROM invoices i, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end;\n\n{\"sql\": \"WITH sy AS (SELECT date(strftime('%Y','now')||'-07-01') AS start, date(strftime('%Y','now')||'-06-30','+1 year') AS end) SELECT ROUND(SUM(total_cost) / 12, 2) AS average_monthly_spend FROM invoices i, sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end;\"}", "sql_used": null, "rows": null, "html": "<p>These questions ask for an average monthly spend across the school year. We use the invoices table scoped by district_key and define a school\u2011year CTE with sy.start as July 1 and sy.end as June 30 of the following year. We filter invoice_date between sy.start and sy.end. Instead of grouping by month, we compute SUM(total_cost) over all invoices in this window. We then divide this sum by 12 (the number of months in a school year), often with rounding for readability. The result is a single scalar representing the average monthly district spend for the current school year.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for all month-based aggregations.\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Average Monthly Spend\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start,\n         date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end\n)\nSELECT ROUND(SUM(total_cost) / 12, 2) AS average_monthly_spend\nFROM invoices i, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end;\n\n{&quot;sql&quot;: &quot;WITH sy AS (SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start, date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end) SELECT ROUND(SUM(total_cost) / 12, 2) AS average_monthly_spend FROM invoices i, sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end;&quot;}</p>"}
{"id": "0054", "question": "What is the district's average monthly hours this school year?", "text": "These questions ask for an average monthly hours figure across the school year. We use the invoices table scoped by district_key and define a school\u2011year CTE with sy.start as July 1 and sy.end as June 30 of the following year. We filter invoice_date between sy.start and sy.end. We compute SUM(total_hours) over all invoices in this window and then divide by 12 (the number of months in a school year), often with rounding. The result is a single scalar representing the average monthly hours for the district during the current school year.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Average Monthly Hours\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime('%Y','now')||'-07-01') AS start,\n         date(strftime('%Y','now')||'-06-30','+1 year') AS end\n)\nSELECT ROUND(SUM(total_hours) / 12, 2) AS average_monthly_hours\nFROM invoices i, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end;\n\n{\"sql\": \"WITH sy AS (SELECT date(strftime('%Y','now')||'-07-01') AS start, date(strftime('%Y','now')||'-06-30','+1 year') AS end) SELECT ROUND(SUM(total_hours) / 12, 2) AS average_monthly_hours FROM invoices i, sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end;\"}", "sql_used": null, "rows": null, "html": "<p>These questions ask for an average monthly hours figure across the school year. We use the invoices table scoped by district_key and define a school\u2011year CTE with sy.start as July 1 and sy.end as June 30 of the following year. We filter invoice_date between sy.start and sy.end. We compute SUM(total_hours) over all invoices in this window and then divide by 12 (the number of months in a school year), often with rounding. The result is a single scalar representing the average monthly hours for the district during the current school year.\n\n---\n\n# CareSpend Database Schema Reference\nThis document defines the structure, meaning, and relationships of all database tables used by the CareSpend Analytics Agent.  \nIt is intended for fine-tuning GPT-4.1 models to produce accurate SQL queries.\n\n---\n\n# ============================\n# 1. TABLE: invoices\n# ============================\n\nStores **one aggregated invoice per student per vendor per service month**.\n\n## Columns:\n- **id** (INTEGER, PK)  \n  Unique identifier for each invoice.\n\n- **vendor_id** (INTEGER, FK \u2192 vendors.id)  \n  Vendor providing the services.\n\n- **student_name** (TEXT)  \n  Student billed for this invoice.  \n  Normalized case-insensitive comparison is required.\n\n- **service_month** (TEXT)  \n  Billing period in \u201cYYYY-MM\u201d format.  \n  Used for:\n  - Year-to-date (YTD) calculations  \n  - School-year windows  \n  - Trend analysis\n\n- **total_hours** (REAL)  \n  Sum of all service hours for this student/vendor in that month.\n\n- **total_cost** (REAL)  \n  Sum of all charges for this student/vendor in that month.\n\n- **invoice_date** (TEXT / DATETIME)  \n  Actual invoice processing date.\n\n- **district_key** (TEXT)  \n  Required for filtering all queries.  \n  All SQL must scope by district_key.\n\n- **created_at** (TEXT / DATETIME, optional)  \n  Typically used for:\n  - Sorting invoices  \n  - Identifying recent entries\n\n## When to use this table:\n- Any query involving **total cost**  \n- Any query involving **total hours** (aggregated by vendor or student)  \n- Month-to-month comparisons  \n- Year-to-date (YTD) calculations  \n- School-year summaries  \n- Trend analysis over months  \n- Ranking highest-cost students  \n- Ranking highest-hours students  \n- Ranking vendors by cost  \n- Ranking vendors by hours  \n- Comparing two students (cost or hours)  \n- Comparing two vendors (cost or hours)\n\n---\n\n# ============================\n# 2. TABLE: invoice_line_items\n# ============================\n\nStores **detailed service entries** for each invoice.\n\nEach row represents a **single service provided on a single day**.\n\n## Columns:\n- **id** (INTEGER, PK)\n\n- **invoice_id** (INTEGER, FK \u2192 invoices.id)\n\n- **student** (TEXT)  \n  Student served on this line item.\n\n- **clinician** (TEXT)  \n  Clinician providing the service (LVN, RN, HA, etc.).\n\n- **service_code** (TEXT)  \n  License / classification for clinician type (LVN, RN, HHA, CNA, etc.)\n\n- **service_date** (TEXT / DATE)  \n  Actual date the service delivered.\n\n- **hours** (REAL)  \n  Hours billed for this entry.\n\n- **cost** (REAL)  \n  Cost for this entry.\n\n## When to use this table:\n- Detailed invoice summaries  \n- Day-by-day review  \n- Clinician-level analysis  \n- Clinician-type analysis  \n- Vendor line-item analysis  \n- Student service breakdown  \n- Temporal analysis\n\n---\n\n# ============================\n# SQL TEMPLATE: Average Monthly Hours\n# ============================\n\nWITH sy AS (\n  SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start,\n         date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end\n)\nSELECT ROUND(SUM(total_hours) / 12, 2) AS average_monthly_hours\nFROM invoices i, sy\nWHERE i.district_key = :district_key\n  AND date(i.invoice_date) BETWEEN sy.start AND sy.end;\n\n{&quot;sql&quot;: &quot;WITH sy AS (SELECT date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-07-01&#x27;) AS start, date(strftime(&#x27;%Y&#x27;,&#x27;now&#x27;)||&#x27;-06-30&#x27;,&#x27;+1 year&#x27;) AS end) SELECT ROUND(SUM(total_hours) / 12, 2) AS average_monthly_hours FROM invoices i, sy WHERE i.district_key = :district_key AND date(i.invoice_date) BETWEEN sy.start AND sy.end;&quot;}</p>"}
